---
weight: 15
title: 添加服务
sourceSHA: 64a21a7dd9f4711d2f4b363c819ff88911de9ab52ac937032b0a39064360a693
---

本文件将指导您创建一个 ServiceMesh 服务。

## 前置条件

- 当前命名空间已添加至服务网格。有关说明，请参考 \[添加命名空间]\({{\<relref "/mesh-u-servicemesh/add-namespaces">}})。
- 工作负载类型为 Deployment，并且与 Service 存在一对一关联。

## 步骤

1. 在左侧导航栏中，点击 **服务列表**。

2. 点击 **添加服务**。

3. 请参考以下说明以配置相关参数。

| 参数                                 | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ----------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Deployment**                      | 当前命名空间下在容器平台上的 Deployment，这是运行服务的计算组件。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **内部路由**                        | 与所选 Deployment **一对一** 关联的内部路线的信息，支持对路线的协议和容器名称进行修改。<br>**内部路由** 必须满足以下条件：<br>- 仅有一个内部路由与所选 Deployment 关联，并且该路由专门链接至该 Deployment。<br>- 内部路由的类型为 **NodePort** 或 **ClusterIP**。<br>- 服务仅支持 HTTP、HTTP2、gRPC、TCP 协议。请勿添加不支持的内部路由协议，因为这可能导致服务调用错误。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **边车配置**                        | 在 **服务网格** 或 **复合** 治理模式下，添加的服务将自动注入一个边车。这意味着当服务 Pod 启动时，边车容器也将在 Pod 中启动，以接管服务的进出流量并管理和治理服务。<ul><li>您可以通过资源配置控制边车的资源分配。</li><li>您可以配置边车的日志级别。</li><li>您可以根据需要配置流量穿透，具体请参见 \[流量穿透]\({{< relref "mesh-u-servicemesh/managing-traffic/10other-advanced-op.md#passthrough" >}})。</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **跨集群服务发现**                  | **注意**：此参数仅在当前服务网格为 **多集群服务网格**（至少包含两个集群）时可见。<br><br>是否将服务暴露给由网格管理的所有集群，使得其他集群下的任何服务或网关能够直接访问当前服务。<br>**跨集群服务发现** 开关是一个全局（网格级别）参数。更改网格中任何具有相同名称的服务的开关状态，将影响所有同名服务（与所选 Deployment 关联的内部路由同名的服务）在所有集群中的状态。<br>**说明**：**同名服务**是指在由服务网格管理的不同集群中，命名空间名称也相同的服务；成功添加的服务及与所选 Deployment 关联的内部路由 **名称相同**。<br><br>**当开关开启时**，在服务成功添加后：<ul><li>如果在任何其他管理集群中没有与所选 Deployment 关联的内部路由名称匹配的服务，则将在相应集群中同步创建一个具有相同名称的内部路由以进行服务发现。**在其他集群创建同名内部路由时**：</li><ul><li>如果该集群中没有与当前命名空间同名的命名空间，将导致内部路由创建失败，进而无法提供跨集群服务发现能力。</li><li>如果在与所选 Deployment 关联的命名空间中存在一个与所选 Deployment 关联的内部路由同名的现有内部路由，则将使用现有的内部路由。**注意**：如果现有内部路由的配置详情与当前选定的 Deployment 关联的内部路由不同，可能无法实现跨集群服务发现。</li></ul><li>网格中所有同名服务的 **跨集群服务发现** 开关将在所有集群中开启。</li></ul> |

1. 点击 **添加**。

   在服务成功添加后：

   - （在 **服务网格** 治理方法下）服务列表中将生成一个与 **服务** 同名的服务。

   - 平台将自动更新服务的 Deployment 的 Pod 模板参数，添加或更新 `app: <服务名称>` 标签。<br>建议不要在 YAML 文件中直接修改这些标签。

   - 重启服务的 Deployment。<br>在重启过程中，只要至少有一个 Deployment 的 Pod 处于 **运行** 状态，服务即为 **在线**；否则，服务为 **离线**。
