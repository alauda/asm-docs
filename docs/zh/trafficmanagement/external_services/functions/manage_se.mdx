---
weight: 10
sourceSHA: 862b8bbae5246569618fd4840e2ed5027f085fd61965e2e14cb5929489d5a40d
---

# 外部服务管理

## 介绍

支持将非网格服务集成到服务网格治理中，以便于：

- 解决混合云连接挑战
- 管理传统系统的流量
- 实施安全的出口控制

核心价值：为内部/外部服务提供统一的政策执行

## 特性

- 支持第 4/7 层协议  
- 出口网关绑定  
- DNS/VIP 地址注册  
- 多端口配置  

## 优势

- 跨环境的协议一致性
- 命名空间级流量隔离
- 创建后固定协议
- 每个服务最大支持 5 个端口

## 创建外部服务

### 第 1 步：基本配置

1. 导航至：**服务网格** > **外部服务**
2. 选择目标集群
3. 点击 **添加外部服务**

| 参数             | 要求       | 描述                              |
| ---------------- | ---------- | ---------------------------------- |
| 服务协议        | 必需       | HTTP/HTTPS/TCP                     |
| 服务地址        | 必需       | L7 的域名/VIP，L4 的 IP 列表       |
| 服务端口        | 必需       | 最多支持 5 个端口                   |

### 第 2 步：出口网关绑定

1. 切换 **绑定出口网关**
2. 配置参数：

| 参数          | 值示例       | 约束                    |
| -------------- | ------------ | ----------------------- |
| 命名空间      | istio-system  | 必须存在               |
| 指定端口      | 80:HTTP      | 协议匹配               |
| 绑定命名空间  | 全部/自定义  | 需要侧车                |

### 第 3 步：请求重写

配置示例：
- 原始：`http://www.example.com:80`  
- 目标：`www.example123.com:8080/v1/service1`  

---

# 负载均衡策略配置

## 介绍

通过以下方式优化外部服务的流量分配：

- 防止端点过载
- 保持会话一致性
- 启用特定协议的调优

核心价值：99.9% 的可用性保障

## 特性

- 4 种负载均衡算法  
- HTTP 头/source IP/cookie 持续性  
- 健康检查集成  
- 特定协议优化  

## 优势

- 有状态服务的会话连续性
- 自动故障转移机制
- L4/L7 协议感知
- 符合 GDPR 的路由

## 策略创建步骤

### 第 1 步：访问策略接口

1. 选择目标外部服务
2. 导航至：**策略** > **创建策略** > **负载均衡**

### 第 2 步：算法选择

| 算法          | 协议支持      | 描述                           |
| -------------- | -------------- | ------------------------------- |
| 最少请求      | HTTP/HTTPS     | 从 2 个健康实例中选择          |
| 随机          | TCP/HTTP       | 随机分配                       |
| 轮询          | TCP/HTTP       | 循环分配                       |
| 会话          | HTTP/HTTPS     | 会话持续性                     |

### 第 3 步：会话配置

**HTTP 头持久性**

| 参数         | 示例        |
| ------------ | ------------ |
| 头部名称     | User-Agent  |

**Cookie 设置**

| 参数        | 要求            |
| ------------ | ---------------- |
| 名称        | 必需               |
| ttl         | 300-3600 秒      |

---

# 熔断器策略实施

## 介绍

通过以下方式保护服务：

- 自动隔离故障端点
- 限制并发连接
- 管理请求重试

核心价值：防止级联故障

## 特性

- 5xx 错误检测  
- 动态隔离持续时间  
- 连接池限制  
- 部分恢复机制  

## 优势

- 渐进式主机重新引入
- HTTP/2 协议优化
- 内置健康监测
- 故障减少 80%

## 策略配置

### 第 1 步：访问策略接口

1. 选择目标服务
2. 导航至：**策略** > **创建策略** > **熔断器**

### 第 2 步：阈值设置

| 参数              | 默认值     | 影响                   |
| ------------------ | ---------- | ---------------------- |
| 连续错误         | 5          | 灵敏度                 |
| 检查间隔         | 30秒       | 检测频率               |
| 基础隔离         | 1分钟      | 初始隔离               |
| 最大隔离         | 30%        | 安全阈值               |

### 第 3 步：验证

平台自动检查流程：

1. 定期健康检查（每 30 秒）
2. 隔离故障实例（最大 30%）
3. 渐进式隔离持续时间
4. 自动恢复机制
