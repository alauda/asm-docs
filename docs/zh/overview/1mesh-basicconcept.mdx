---
title: 基本概念
description: 对 Service Mesh 产品中涉及的基本概念的介绍。
weight: 1
sourceSHA: 0906406ef40350b108e50da7f44cfd8d85193349ff681287d8a3303275363bd1
---

## Service Mesh

Service Mesh 是添加到应用程序中的独立且可配置的基础设施层。它用于管理和控制微服务应用程序之间的通信，提供服务流量管理、服务监控、服务访问安全控制和服务发布的能力。

在传统的微服务架构中，服务之间的通信通常由应用程序代码直接处理，这增加了复杂性和耦合度。服务网格通过在每个服务 Pods 中部署轻量级代理（Envoy，作为边车容器）来管理和控制服务间的通信。这些代理与应用程序代码是分开的，处理请求路由、负载均衡、故障恢复、流量控制和安全认证等任务，使开发人员能够专注于业务逻辑，而无须担心潜在的通信机制和功能。

通过引入服务网格，开发人员可以更好地管理和控制微服务应用程序之间的通信，并在不修改应用程序代码的情况下添加新功能。服务网格支持多种基础设施，如虚拟机和容器，并且可以与容器编排平台（例如 Kubernetes）集成，以在云原生时代提供更好的容器化微服务架构体验。

## Istio

[Istio](https://istio.io/latest/about/service-mesh/) 是一个开源服务网格，它能够透明地集成到现有的分布式应用程序中，以提供流量管理、策略执行、遥测收集和安全保障。Istio 为微服务架构提供全面的服务治理能力，支持多种编程语言，并主要使用 Kubernetes 作为服务注册中心。

Istio 提供强大的功能，以统一和高效的方式保护、连接和监控服务。使用 Istio，您可以在最小或没有服务代码更改的情况下实现负载均衡、服务间认证和监控。它提供以下关键功能：

- 在集群内安全地进行服务间通信，包括 TLS 加密、基于身份的认证和授权。
- HTTP、gRPC、WebSocket 和 TCP 流量的自动负载均衡。
- 通过丰富的路由规则、重试、故障转移和故障注入，实现对流量行为的细粒度控制。
- 可插入的策略层和配置 API，用于访问控制、速率限制和配额管理。
- 自动收集来自集群内所有流量的指标、日志和跟踪，包括进出流量。
- 可以满足多种部署需求的可扩展性。控制平面运行在 Kubernetes 上，您可以将集群中部署的应用程序添加到网格中，将网格扩展到其他集群，甚至连接到 Kubernetes 之外的虚拟机或其他终端。

Istio 的架构如下所示。

<img src="/zh/33servicemesh.svg" width="600" />

**控制平面**

Istio 控制平面负责管理和配置代理。它与数据平面代理（Envoy）进行通信，以发送配置和指令来控制服务流量、管理安全性以及收集和处理遥测数据。它允许管理员和开发人员以集中方式管理整个服务网格，并灵活配置。

**数据平面**

Istio 数据平面由一组智能代理（Envoy）组成，这些代理作为边车容器在服务 Pods 中部署和运行。这些代理负责拦截、处理和转发服务之间的所有流量。

数据平面执行流量管理、故障恢复、安全策略执行等功能，以确保服务间通信的可靠性和安全性。它还提供丰富的监控和跟踪功能，帮助开发人员理解和调试服务通信行为。

**Envoy**

[Envoy](https://istio.io/latest/docs/ops/deployment/architecture/#envoy) 是用于 Istio 数据平面代理的组件，是唯一与数据平面流量交互的 Istio 组件。

Envoy 被部署并作为边车容器在服务 Pods 中运行，处理和转发服务网格中服务的所有入站和出站流量，提供流量控制、负载均衡、故障恢复和安全等网络功能和管理特性。

**边车**

边车模式在微服务和容器化应用程序中被广泛使用，通过在主应用程序容器旁边添加辅助容器或代理来增强应用程序的功能和性能。

作为 Istio 数据平面的 Envoy 被部署为服务 Pods 中的边车容器。

**服务网关**

服务网关包括 Egress Gateway 和 Ingress Gateway，运行在服务网格的边缘，管理进入和离开网格的流量。它们允许您指定允许离开或进入网格的流量。

## OpenTelemetry

OpenTelemetry 是一个开源可观测性框架，旨在生成、处理和传输遥测数据，包括指标、日志和跟踪。由云原生计算基金会（CNCF）开发，它提供了一套标准协议和工具，将数据发送到任何可观测性后端。OpenTelemetry 的核心组件包括：

- Collector：接收、处理和导出遥测数据。
- 语言 SDK：允许使用特定语言中的 OpenTelemetry API 生成遥测数据。
- 监测库：自动或手动为应用程序添加监测以收集遥测数据。

OpenTelemetry 支持多种语言和第三方注册中心，为 JVM 和中间件提供可观测性数据。它定义了行业标准的数据规范，便于与各种开源可观测性工具更好的集成。

## Istio 与 OpenTelemetry 的技术比较

| 特性/能力                     | Istio                                                                                                                                                                                                                                                               | OpenTelemetry                                                                                                                                                                                                                                                     |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **协议支持**                 | 支持 gRPC、HTTP、TCP 协议。                                                                                                                                                                                                                                          | 支持 HTTP、TCP 和各种 RPC 协议，如 Dubbo、Redis 等。                                                                                                                                                                                                              |
| **服务治理**                 | 提供负载均衡、熔断、连接池、超时重试等功能。                                                                                                                                                                                                                            | 无治理能力。                                                                                                                                                                                                                                                      |
| **服务路由**                 | 提供丰富的路由规则和策略，例如加权路由、请求头路由、流量镜像、故障注入等。                                                                                                                                                                                              | 无路由能力。                                                                                                                                                                                                                                                       |
| **拓扑与调用链**             | 显示网格内的所有节点，包括服务、入口网关、服务条目、出口网关，排除中间件节点。<br />调用链包括服务的 HTTP 调用跨度，包含 URL、状态码等数据。                                                                                                                       | 显示节点，包括服务和中间件，排除入口和出口网关。<br />调用链包括 HTTP 链接数据、内部方法调用链数据和服务到中间件的链接数据。跨度数据也可以通过 SDK 主动报告。                                                                                           |
| **监控数据**                 | 提供服务的完整进出流量指标。                                                                                                                                                                                                                                       | 提供服务的完整进出流量指标，以及 JVM 指标。                                                                                                                                                                                                                        |
| **注册兼容性**               | 支持 Kubernetes 作为服务注册中心。                                                                                                                                                                                                                                   | 支持第三方注册中心和 Kubernetes 注册中心。                                                                                                                                                                                                                       |
| **跟踪 ID 传播**             | 需要代码更改以实现跟踪 ID 传播。                                                                                                                                                                                                                                   | 实现自动跟踪 ID 传播。                                                                                                                                                                                                                                           |
| **资源需求**                 | 可能需要更多计算资源，因为每个服务实例都需要一个 Envoy 代理。                                                                                                                                                                                                         | 需要较少的额外资源，不需为每个服务实例添加代理。                                                                                                                                                                                                                 |

### 选择建议

- **服务治理**：如果需要服务治理，Istio 是更好的选择。
- **可观测性**：如果需要强大的可观测性支持，尤其是针对 JVM 监控，OpenTelemetry 更为合适。
- **资源受限环境**：在资源有限的环境中，OpenTelemetry 可能是一个更轻量的选择，因为它不需要每个服务实例旁边都有代理。
- **多语言和注册支持**：对于需要多语言支持和使用第三方注册中心的场景，OpenTelemetry 提供了更多灵活性。
- **非侵入式跟踪 ID 传播**：如果您使用 Java 应用程序并希望实现非侵入式的跟踪 ID 传播以进行全栈跟踪，使用 OpenTelemetry 的 Java Agent 是一个很好的选择。

每种技术都有其独特的优势和适用场景。选择应基于具体的业务需求、技术栈以及未来可扩展性和集成的考虑。在某些情况下，二者可以结合使用，以实现全面的服务治理和可观测性解决方案。
