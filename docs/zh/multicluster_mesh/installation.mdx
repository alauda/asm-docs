---
weight: 15
i18n:
  title:
    en: Installation
    zh: 安装
sourceSHA: dafe2339c1ed2579a179c5a32a18e0c8269b51c39a1266f375a534ecf9d9d69c
---

# 安装

本文将使用两个位于不同 VPC（虚拟私有云）的 AWS EKS（Amazon Elastic Kubernetes Service）集群 c1 和 c2 作为示例，说明如何构建多集群、多网络的服务网格。

:::note

为了演示的目的，本文仅选择了两个集群来构建网格。在实际操作中，您可以根据需要添加更多满足前提条件的集群到服务网格。

:::

## 前提条件

- 对于私有云，确保在所有集群上配置了 Kubernetes LoadBalancer（例如，MetaLB），以为部署在集群上的 Istio 网关提供负载均衡能力。
- 所有集群已连接到平台。
- 所有集群的监控组件已通过 <ExternalSiteLink name="acp" href="/observability/monitor/functions/install_monitor.html#install-the-acp-monitoring-with-victoriametrics-plugin" children="部署监控组件" /> 部署，包括 **VictoriaMetrics**。 <br />为了确保来自多个集群的监控数据能够聚合，请确保要添加到网格的多个集群的监控数据能够收集到同一个 VictoriaMetrics 中心，并使用相同的数据查询地址。
  **注意**：经过测试，**VictoriaMetrics** 很好地支持 **多主架构** 的服务网格。有关其他监控解决方案的支持，请联系技术支持。
- 所有集群中的 **控制节点** 和 **负载均衡设备**（如有）必须开放 kube-apiserver 的端口 `6443`，并且负载均衡设备的 `6443` 端口必须将流量转发到控制节点的 `6443` 端口。
- 确保集群的 Kubernetes 版本与平台支持的 Istio 版本兼容。详细信息，请参见 [Istio 受支持的 Kubernetes 版本](https://istio.io/latest/docs/releases/supported-releases/)。

## 创建服务网格

选择准备好的集群之一，创建服务网格。

在创建网格时，配置相应的参数如下，并根据需要配置其他参数：

- 部署 Istio 以构建网格。
- 在 **网格架构** 中选择 `多集群` 。
- 在 **网络类型** 中选择 `多网络` 。
  **注意**：平台将自动为所有加入网格的集群部署东西向流量网关，以连接集群之间的网络。
- 在 **监控系统** 中与 `平台` 提供的监控组件集成。

## 添加集群

1. 在左侧导航栏中，点击 **服务网格** > **网格**。
2. 点击要添加的集群的 ***服务网格名称***。
3. 在 **网格详细信息** 标签下，在 **网格部署** 部分，点击 **添加集群**。
4. 在 **基本信息** 部分，选择要加入服务网格的集群。
5. 根据实际部署需要，配置集群级别的网格配置和组件。
6. 点击 **添加**。

   **注意**：

   - 添加成功后，系统将按顺序在该集群上部署服务网格相关组件。点击 <img src="./assets/show_status.png" style={{display: "inline", verticalAlign: "middle"}} /> 在 **网格部署** 部分查看部署进度。

   - 添加集群后，网格的全局配置（监控系统、Elasticsearch 集成配置）将自动同步到新添加的集群。
