---
weight: 10
sourceSHA: b5d74ede1b96e4c7e0525ff28bd89eff238ea0aa5d9d4145b71b025a1ef75c96
---

# 查询跟踪

## 功能概述

分布式追踪查询功能通过收集服务间调用的元数据，提供微服务架构的全链路追踪能力，帮助用户快速定位跨服务调用问题。此功能主要解决以下问题：

- **请求链接追踪**：在复杂的分布式系统中恢复完整的请求路径。
- **性能瓶颈分析**：识别链接中耗时异常的调用节点。
- **故障根因定位**：通过错误标记快速定位问题发生的点。

适用场景包括：

- 在生产环境故障排除过程中迅速定位异常服务。
- 在性能调优期间识别高延迟的调用链路。
- 在新版本发布后验证服务间调用关系。

核心价值：

- 增强分布式系统的可观察性。
- 降低平均恢复时间（MTTR）。
- 优化服务间调用性能。

## 主要特性

- 多维查询：支持包括 TraceID、服务名称、标签等的 9 种查询条件组合。
- 可视化分析：通过时间序列瀑布图直观展示调用层级和时间分布。
- 精确定位：支持错误 Span 过滤和使用标签的二次搜索。

## 功能优势

- **快速问题识别**：通过多维查询条件缩小检查范围，加速问题定位。
- **可视化呈现**：使用时间序列瀑布图直观展示调用关系，降低复杂度，提高故障分析效率。
- **灵活多样**：支持简单查询和复杂组合，适应各种运维和开发场景。

## 跟踪查询

<Steps>
  ### 步骤 1：组合查询条件

  **提示**：查询条件可以组合使用。您可以通过添加多个查询条件来细化查询。

  | 查询条件             | 描述                                                                                                                                                                                                                                                                                                         |
  | --------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
  | **TraceID**           | 完整链接的唯一标识符，可用于查询指定的追踪信息。                                                                                                                                                                                                                                                            |
  | **服务**             | 发起/接收调用请求的服务或入口网关（输入必填）。格式为 `<service/gateway name>.<namespace name>`，例如 `bookinfo-gw.bookinfo-ns`。                                                                                                                                                                      |
  | **客户端**           | 发起调用请求的客户端服务或入口网关（输入必填）。格式为 `<service/gateway name>.<namespace name>`。                                                                                                                                                                                                 |
  | **服务器**           | 响应调用请求的服务器服务或入口网关（输入必填）。格式为 `<service/gateway name>.<namespace name>`。                                                                                                                                                                                                     |
  | **API**               | 在 **服务 > API** 中为服务添加的 API。                                                                                                                                                                                                                                                                       |
  | **标签**              | 您可以通过输入标签（Tag）来过滤查询结果。支持的标签包括在 Span 详情中找到的标签。                                                                                                                                                                                                                          |
  | **Span 持续时间 >**   | 持续时间大于或等于 *输入值*（毫秒）的 Spans。                                                                                                                                                                                                                                                                  |
  | **仅错误追踪**       | 错误 Spans 指 Tag 值为 **error** 的 Span，其值为 `true`。                                                                                                                                                                                                                                                     |
  | **Span 类型**         | **根 Span**：搜索由配置的 **服务** 发起的根 Spans。该搜索模式用于当配置的服务是整个调用请求的发起者时。 <br />**服务入口 Span**：搜索当配置的 **服务** 作为服务器被调用时生成的第一个 Span。                                                                  |
  | **最大查询计数**     | 可查询的最大 Span 数量，默认为 `200`。 <br />**提示**：出于性能考虑，平台一次最多可显示 1000 个 Spans。如果满足查询条件的 Span 数量超过 **最大查询计数**，您可以细化查询条件或缩小时间范围进行分批查询。 |

  ### 步骤 2：执行查询

  - 选择查询条件并输入相应值后，点击 **添加到查询** 按钮，当前条件将显示在 **查询** 结果区域，触发查询。
  - 您还可以展开 **常用搜索条件** 以快速添加近期使用的搜索条件。
</Steps>

## 查询结果分析

输入查询条件并进行搜索后，页面上将生成查询结果区域。

### Span 列表

查询结果区域左侧显示符合条件的 Span 列表及 Span 的基本信息，包括：服务名称、被调用的接口或请求处理方式、持续时间和开始时间。

### 时间序列瀑布图

查询结果区域右侧的时间序列瀑布图清晰展示单个追踪中 Spans 之间的调用关系。在追踪分析中使用时间序列瀑布图的主要特性如下：

1. 自上而下扩展：在时间序列瀑布图中，各种调用事件（Spans）通常从图表顶部向下扩展，每个横条表示一个服务调用或过程。位置通常反映操作的逻辑调用顺序。
2. 时间轴对齐：时间序列瀑布图的横轴代表时间。每个条形的长度表示该调用的持续时间，允许对不同调用之间的时间关系进行直观比较。
3. 缩进描述：缩进表示调用的层次关系，缩进越深表示在该链接内调用的深度越大。
4. 交互性和详细数据展示：点击时间序列瀑布图中的条形可以显示该调用的更详细信息。

### Span 详情

点击时间序列瀑布图中 Span 的行，可以展开查看该 Span 的详细信息，包括：

- 服务：Span 内的服务。
- Span 持续时间（毫秒）：Span 的持续时间。
- URL：服务访问的 URL，对应于 Span 标签中的 **http.url**。
- 标签：由键值对组成的 Span 标签信息，可用于高级搜索标签查询条件。点击标签旁边的按钮可以将当前标签条件添加到查询条件中，以获得更精确的查询结果。
- JSON：Span 的原始 JSON 结构，允许进一步检查其内部信息。
