---
weight: 30
sourceSHA: d034541adb23c9609f9e0af3a3c082a5e74f9e2d3fb8533d2048a89b16e5e64d
---

# 使用 OpenTelemetry 服务内置标签进行追踪

## 功能概述

Span 标签是附加到 Span 的键值对数据，为每个 Span 提供特定的上下文信息，帮助开发者更轻松地理解和分析每个操作的特征和影响。

标签由 `key` 和 `value` 组成，其中 `key` 必须为字符串类型，而 `value` 可以是字符串、布尔值或数字。

## 标签分类

### 元数据

| 键                           | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                              | 示例值       |
| ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------- |
| **internal.span.format**      | 内部 Span 的数据格式。                                                                                                                                                                                                                                                                                                                                                                                                                            | `otlp`        |
| **otel.status\_code**         | Span 的状态。                                                                                                                                                                                                                                                                                                                                                                                                                                     | `ERROR`       |
| **span.kind**                 | Span 的类型：<br />- **client**: 表示 Span 是一个出站调用（客户端操作），即客户端向服务或资源发起请求。<br />- **server**: 表示 Span 是一个入站调用（服务器操作），即服务器接收并处理了来自客户端的请求。<br />- **internal**: 表示应用程序内部操作，不涉及与远程父或子操作。                                                                           | `client`      |

### HTTP 请求信息

| 键                                | 描述                                                                                                                                                                          | 示例值                       |
| ---------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------- |
| **http.flavor**                    | HTTP 协议的版本。                                                                                                                                                           | `1.1`                         |
| **http.method**                    | HTTP 请求方法。                                                                                                                                                             | `GET`                         |
| **http.response\_content\_length** | HTTP 请求头中的一个字段，指定请求或响应主体的字节长度。                                                                                                                      | `12`                          |
| **http.route**                     | API。                                                                                                                                                                        | `/get/{code}`                |
| **http.scheme**                    | HTTP 协议的类型。                                                                                                                                                           | `http`                        |
| **http.status\_code**              | HTTP 状态码。                                                                                                                                                                | `200`                         |
| **http.target**                    | HTTP 请求的目标路径，通常包括资源路径和可能的查询参数。                                                                                                                     | `/get/200?foo=bar`           |
| **http.url**                       | 请求的 URL。<br />**注意**: 仅对 `client` Span 类型可见。                                                                                                                    | `http://calendar-app:9090/calendar` |
| **http.user\_agent**               | User-Agent 请求头，是一个特征字符串，帮助服务器和伙伴识别请求用户代理的应用程序、操作系统、厂商和版本。                                                            | `okhttp/4.10.0`              |
| **upstreamURLPath**                | 上游服务的 URL 路径，指定应由上游服务处理的资源路径，包括可能的查询参数。                                                                                                  | `/get/200?foo=bar`           |

### 服务

| 键                              | 描述                                                  | 示例值         |
| ------------------------------- | ----------------------------------------------------- | --------------- |
| **inner.client.cluster.name**   | 集群的名称。                                         | `global`        |
| **inner.client.env.type**       | 服务的类型。                                         | `vm`, `k8s`     |
| **inner.client.ms.name**        | 服务的名称。                                         | `notes-app`     |
| **inner.client.ms.namespace**   | 服务所在的命名空间。                                 | `otel-ns`       |
| **net.host.name**               | 网络主机名称。                                      | `calendar-app`  |
| **net.host.port**               | 网络主机端口。                                      | `9090`          |
| **net.sock.host.addr**          | 通过网络套接字连接的主机地址。                      | `10.3.0.118`    |
| **net.sock.peer.addr**          | 网络套接字的对等地址。                              | `10.3.0.117`    |
| **net.sock.peer.port**          | 网络套接字的对等端口号。                            | `44794`         |
| **net.transport**               | 网络传输协议。                                      | `ip_tcp`        |
| **thread.id**                   | 线程的唯一标识符。                                  | `30`            |
| **thread.name**                 | 线程的名称。                                       | `http-nio-9090-exec-9` |

### 中间件

| 键                          | 描述                                                                                                                                                                                    | 示例值                                                                            |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------- |
| **db.system**                | 中间件类型。目前支持的类型包括：**mysql**、**oracle**、**postgresql**、**redis**。                                                                 | `mysql`                                                                          |
| **db.connection\_string**    | 连接字符串。这是一个表达式，包含应用程序连接数据库服务器所需的参数，包括服务器实例、数据库名称和身份验证详细信息。                     | `oracle:thin://oracle11g:1521`                                               |
| **dn.name**                  | 数据库名称。                                                                                                                                                                                 | `db1`                                                                           |
| **db.sql.table**             | 数据库表的名称。                                                                                                                                                                            | `students`                                                                      |
| **db.operation**             | 数据库操作类型。                                                                                                                                                                            | `SELECT`                                                                        |
| **db.statement**             | 数据库查询语句。                                                                                                                                                                            | `SET redis ?`<br />`select student0_.id as id1_0_0_, student0_.age as age2_0_0_ from students student0_ where student0_.id=?` |
| **net.peer.name**            | 中间件服务的名称。                                                                                                                                                                          | `pg.ns`                                                                         |
| **net.peer.port**            | 中间件服务的端口。                                                                                                                                                                          | `5432`                                                                          |
| **net.sock.peer.name**       | Redis 服务的名称。                                                                                                                                                                          | `redis`                                                                         |
| **net.sock.peer.addr**       | Redis 服务的 IP 地址。                                                                                                                                                                       | `10.4.199.164`                                                                  |
| **net.sock.peer.port**       | Redis 服务的端口。                                                                                                                                                                          | `6379`                                                                          |

### 进程

| 键                              | 描述                                                   | 示例值                                                                                                                                                         |
| ------------------------------- | ----------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **cluster.name**                | 集群的名称。                                         | `global`                                                                                                                                                         |
| **container.id**                | 容器的 ID。                                         | `b960b4f13d0e28fdc296195c4c7c57152fa4e689bb473bf8718ec817a7eea481`                                                                                           |
| **container.name**              | 容器的名称。                                       | `notes-app`                                                                                                                                                     |
| **host.arch**                   | 主机的架构。                                        | `amd64`                                                                                                                                                          |
| **host.name**                   | 主机的名称。                                       | `notes-app-deploy-5f6557bc88-zk7cz`                                                                                                                           |
| **ms.name**                     | 服务的名称。                                       | `notes-app`                                                                                                                                                     |
| **ms.namespace**                | 服务所在的命名空间的名称。                         | `otel-ns`                                                                                                                                                       |
| **os.description**              | 操作系统的描述。                                   | `Linux 3.10.0-1160.11.1.el7.x86\_64`                                                                                                                            |
| **os.type**                     | 操作系统的类型。                                   | `linux`                                                                                                                                                          |
| **otel.library.name**           | Java 库的名称。                                   | `io.opentelemetry.tomcat-7.0`                                                                                                                                 |
| **otel.library.version**        | Java 库的版本。                                   | `1.24.0-alpha`                                                                                                                                                  |
| **process.command\_line**       | Java 进程的命令行参数。                           | `/usr/local/openjdk-11/bin/java \-javaagent:/agent-22wwn/opentelemetry-javaagent-ext.jar -Dotel.instrumentation.runtime-metrics.experimental-metrics.enabled=true`  |
| **process.executable.path**     | Java 进程的可执行文件路径。                      | `/usr/local/openjdk-11/bin/java`                                                                                                                                |
| **process.pid**                 | 进程的标识符。                                    | `7`                                                                                                                                                               |
| **process.runtime.description** | 进程运行时环境的描述。                           | `Oracle Corporation OpenJDK 64-Bit Server VM 11.0.16+8`                                                                                                        |
| **process.runtime.name**        | 进程运行时环境的名称。                           | `OpenJDK Runtime Environment`                                                                                                                                  |
| **process.runtime.version**     | 进程运行时环境的版本。                           | `11.0.16+8`                                                                                                                                                     |
| **telemetry.auto.version**      | Telemetry Auto 的版本。                          | `1.24.0`                                                                                                                                                        |
| **telemetry.sdk.language**      | Telemetry SDK 的语言。                           | `java`                                                                                                                                                             |
| **telemetry.sdk.name**          | Telemetry SDK 的名称。                           | `opentelemetry`                                                                                                                                                  |
| **telemetry.sdk.version**       | Telemetry SDK 的版本。                           |                                                                                                                                                                 |
