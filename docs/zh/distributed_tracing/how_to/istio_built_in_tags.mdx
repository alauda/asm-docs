---
weight: 20
sourceSHA: 3d6fb5cec99ee40d56cd1f842a14e9a32ec2e2b7f14e6545abe0a9855c68b16a
---

# 在追踪中使用 Istio 服务内置标签

## 功能概述

Span 标签是附加到 Span 的键值对数据，为每个 Span 提供特定的上下文信息，帮助开发人员更容易地理解和分析每个操作的特征和影响。

标签由 `key` 和 `value` 组成，其中 `key` 必须是字符串类型，`value` 可以是字符串、布尔值或数字。

## 标签类别

### 元数据

| Key                      | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                             | 示例值        |
| ------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------- |
| **error**                | 指示该 Span 是否为错误。                                                                                                                                                                                                                                                                                                                                                                                                                          | `true`       |
| **internal.span.format** | Internal Span 的数据格式。                                                                                                                                                                                                                                                                                                                                                                                                                       | `zipkin`     |
| **otel.status\_code**    | Span 的状态。                                                                                                                                                                                                                                                                                                                                                                                                                                        | `ERROR`      |
| **span.kind**            | Span 的类型：<br />- **client**：指示该 Span 是出站调用（客户端操作），即客户端向服务或资源发起了请求。<br />- **server**：指示该 Span 是入站调用（服务器操作），即服务器接收并处理了来自客户端的请求。<br />- **internal**：指示在应用程序内部的操作，不涉及与远程父节点或子节点的操作。 | `client`     |

### HTTP 请求信息

| Key                   | 描述                                                                                                                                                                                        | 示例值                                                                                                             |
| --------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------- |
| **guid:x-request-id** | 请求的 ID。                                                                                                                                                                               | `e02b2515-44bb-95c1-859a-ea13718252ad`                                                                             |
| **http.method**       | HTTP 请求方法。                                                                                                                                                                          | `GET`                                                                                                            |
| **http.protocol**     | HTTP 请求使用的协议版本。                                                                                                                                                                 | `HTTP/1.1`                                                                                                       |
| **http.status\_code** | HTTP 状态码。                                                                                                                                                                           | `200`                                                                                                            |
| **http.url**          | 请求的 URL。                                                                                                                                                                             | `http://details:9080/details/0`                                                                                  |
| **user\_agent**       | User-Agent 请求头是一个特征字符串，允许服务器和同级对请求用户的应用程序、操作系统、供应商和/或版本进行标识。                                         | `Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36` |
| **request\_size**     | 请求的大小（以字节为单位）。                                                                                                                                                             | `0`                                                                                                            |
| **response\_flags**   | Envoy 响应标志（参见 [RESPONSE\_FLAGS](https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage#)）。                | `UH`, `DC`, `FI`, `NC`, 等                                                                                       |
| **response\_size**    | 响应的大小（以字节为单位）。                                                                                                                                                             | `5300`                                                                                                         |
| **upstreamURLPath**   | API 的请求路径。                                                                                                                                                                        | -                                                                                                               |

### gRPC 请求信息

| Key                    | 描述                                                                                                  | 示例值                      |
| ---------------------- | ---------------------------------------------------------------------------------------------------- | --------------------------- |
| **grpc.authority**     | gRPC 请求的目标服务的主机。                                                                       | `grpc-svc-a:9090`            |
| **grpc.content\_type** | gRPC 通信协议的内容类型。                                                                           | `application/grpc`           |
| **grpc.message**       | 请求状态的描述。<br />**注意**：仅在返回非零状态代码时可见。                                        | `DATA_LOSS`                  |
| **grpc.path**          | 接口的请求路径。                                                                                   | `/helloworld.Greeter/SayHello` |
| **grpc.status\_code**  | 状态代码，范围从 `0` 到 `15`。代码 `0` 表示正确状态；其他值表示错误。                              | `15`                         |

### 服务

| Key                           | 描述                                                                                                                   | 示例值                                                                                                                                                                                                          |
| ----------------------------- | --------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **asm\_upstream\_cluster**    | 启用了金丝雀发布的上游服务，即下游服务（客户端）实际访问的服务端。                                                | `details-canary.bookinfo-ns.svc.cluster.local` : 表示在为 `details` 服务启用金丝雀发布后，下游服务实际上访问 `details-canary.bookinfo-ns.svc.cluster.local`。                                              |
| **component**                 | 提供服务的组件。                                                                                                      | `proxy`                                                                                                                                                                                                          |
| **downstream\_cluster**       | 下游服务，即客户端服务。                                                                                              | `outbound\|9080\|\|productpage.bookinfo-ns.svc.cluster.local`                                                                                                                                                     |
| **istio.canonical\_revision** | 服务的版本。                                                                                                         | `latest`                                                                                                                                                                                                         |
| **istio.canonical\_service**  | 服务的名称。                                                                                                         | `productpage`                                                                                                                                                                                                    |
| **istio.mesh\_id**            | 服务网格的名称。                                                                                                     | `mesh-example`                                                                                                                                                                                                   |
| **istio.namespace**           | 服务所在的命名空间的名称。                                                                                           | `bookinfo-ns`                                                                                                                                                                                                    |
| **node\_id**                  | 根据 Istio 自己的规则为当前服务生成的 ID。                                                                         | `sidecar~10.5.1.189~bookinfo-productpage-6b5b6c6bbd-vdtsp.bookinfo-ns~bookinfo-ns.svc.cluster.local`                                                                                                            |
| **peer.address**              | 标识与本地设备通讯的远程设备（对等体）的 IP 地址或域名。                                                             | `10.5.1.189`                                                                                                                                                                                                     |
| **upstream\_cluster**         | 上游服务，即服务器服务。                                                                                              | -`outbound\|9080\|\|details-canary.bookinfo-ns.svc.cluster.local` 表示上游服务是 `details-canary.bookinfo-ns.svc.cluster.local`。<br />- `inbound\|80\|\|` 表示没有上游服务。                                  |
| **upstream\_cluster.name**    | 上游服务的名称。                                                                                                     | `outbound\|9080\|\|details-canary.bookinfo-ns.svc.cluster.local`                                                                                                                                               |

### 过程

| Key                | 描述                                           | 示例值                                         |
| ------------------ | ----------------------------------------------- | ---------------------------------------------- |
| **cluster.name**   | 集群的名称。                                  | `global`                                       |
| **container.name** | Sidecar 容器的名称。                         | `istio-proxy`                                  |
| **host.name**      | Pod 的名称。                                  | `bookinfo-productpage-6b5b6c6bbd-vdtsp`       |
| **ms.name**        | 服务的名称。                                  | `productpage`                                  |
| **ms.namespace**   | 服务所在的命名空间的名称。                   | `bookinfo-ns`                                  |
