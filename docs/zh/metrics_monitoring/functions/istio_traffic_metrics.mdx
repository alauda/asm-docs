---
weight: 10
sourceSHA: 449f88a556571358e4906217ace3d8d36de07435d373d495af9fd3965b33ca53
---

# Istio 流量监控指标

该平台提供丰富的流量监控数据，允许用户从多个维度分析服务流量质量。

## 前提条件

服务已经注入了 Sidecar，请参考 [添加服务](../../microservice/add-service.md) 了解详细信息。

## 快速开始

1. 在左侧导航栏中，单击 **监控**。
2. 选择要查看监控数据的服务和时间范围。

   **注意**：查询的时间范围受 Prometheus 监控数据保留期限的限制。例如：如果监控数据的保留期限为 7 天，而设置的时间范围为过去 30 天，则统计数据将仅覆盖 7 天。
3. 单击相应的标签以查看该服务的流量监控数据和 API 流量监控数据。

   **说明**：当服务网格管理多个集群，并且在多个集群中存在 **相同命名空间和名称** 的服务（非 Dubbo 协议服务）时，流量监控面板显示多个集群中服务的聚合监控数据。<br />使用 **集群流量对比** 面板来比较该服务在各个集群中的监控数据。

## 服务流量监控

### 常规操作

- **刷新数据**：当前页的监控统计数据只会在页面打开时自动刷新一次。要再次刷新，可以使用以下两种方法：

  - 手动刷新：单击页面右下角的 <img src="../assets/metric_refresh.png" style={{display: "inline", verticalAlign: "middle"}} /> 手动刷新数据。

  - 设置自动刷新（默认关闭）：单击 <img src="../assets/metric_auto_refresh.png" style={{display: "inline", verticalAlign: "middle"}} /> 设置自动刷新的间隔。

- **查看/设置图例**：单击图表右上角的 <img src="../assets/legend.png" style={{display: "inline", verticalAlign: "middle"}} /> 展开监控图表中的图例。单击图例以隐藏/显示图表中的相应曲线。

- **大图查看监控图**：单击图表右上角的 <img src="../assets/big_chart.png" style={{display: "inline", verticalAlign: "middle"}} /> 在弹出对话框中查看放大且更详细的监控图表。

### 监控数据说明

#### HTTP/HTTP2/gRPC、Dubbo 协议

| 监控指标                            | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| --------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **平均响应时间**                     | 查询时间范围内的平均响应时间（总响应时间/总响应次数）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **平均进/出 RPS**                   | 查询时间范围内进/出 RPS（每秒请求数）的平均值。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **响应时间**                        | 服务间或服务内部的响应时间，显示为平均值、TP 50、TP 95、TP 99。<br />TP（Top Percentile）xx 表示 xx% 网络请求所需的最小持续时间，通常用于系统性能监控场景。<br />将鼠标悬停在曲线上可查看特定时间段的响应时间。                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **进/出 RPS**                      | 查询时间范围内的总进/出流量 RPS和错误的进/出流量 RPS。<br />**RPS = 查询时间段内的请求次数 / 查询持续时间（秒）**。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **进/出流量**                      | 查询时间范围内的总进/出请求量，以及通过 HTTP 返回代码（正常/2xx、3xx、4xx、5xx）的流量比例。<br />将鼠标悬停在柱状图上可以查看每个类别的流量比例。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **客户端流量对比**                 | **客户端**是指向当前服务（上游服务）发起请求的客户端服务（下游服务）。 **客户端流量对比** 将比较并显示不同客户端调用当前服务的 **响应时间**、**进 RPS** 以及进 **RPS 错误率**（错误 RPS/RPS）。<br /><br />**说明**：<br />- **未知客户端**指在服务网格中调用当前服务的客户端（HTTP 协议）集合，其流量未由 Sidecar 管理。<br />- 如果客户端属于当前命名空间，单击客户端名称旁的 **追踪** 将重定向到追踪页面。<br />- 当有两个版本在金丝雀发布服务中时，将显示两个版本的聚合数据。 |

#### TCP 协议

| 监控指标                          | 描述                                                                                                                                                                                                                                                                       |
| --------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **进/出流量**                     | 查询时间范围内的进出流量字节流大小。                                                                                                                                                                                                    |
| **平均进/出流量**                 | 查询时间范围内的进/出流量的平均值（流量/持续时间）。                                                                                                                                                                                        |
| **进/出**                        | 进出服务网络的字节流传输速率（字节每秒）。                                                                                                                                                                                        |
| **TCP 连接数**                   | 连接的总数量。<br />**错误率** = 失败连接数 / 总连接数<br />**成功率** = 成功连接数 / 总连接数<br />将鼠标悬停在不同颜色的柱状图上可查看每个类别的连接数。 |
| **客户端流量对比**               | 比较服务与访问当前服务的客户端服务之间的网络进字节流传输速率。                                                                                                                                            |

## API 流量监控

为了确保监控系统的性能，您需要先在平台上 [声明服务 API](./create_api.mdx)。随后，平台将在服务的流量指标中区分声明的 API 流量质量。

成功声明服务 API 后，您可以在 API 流量监控标签下选择该服务下的 API。

### 监控数据说明

**提示**：在数据查看期间，您可以参考 [常规操作](#regular-operations) 来刷新监控数据或隐藏与图例对应的数据。

- 平均响应时间：在选定时间范围内的平均响应时间（总响应时间/总响应次数）。

- 响应时间：显示为平均值、TP 50、TP 95、TP 99。支持查看单个值的响应时间。将鼠标移动到曲线上以查看特定时间段的响应时间。
  TP xx 表示 xx% 网络请求所需的最小持续时间，通常用于系统性能监控场景。

- 平均进 RPS：选定时间范围内的 RPS 的平均值。

- 进 RPS：每秒请求数，图形显示流量曲线。支持查看总流量 RPS，或单击选择错误流量 RPS。

- 流量：显示在选定时间范围内的访问总次数、平均成功率和平均错误率。颜色代表不同的 HTTP 状态码：深绿色表示成功状态（2XX），浅绿色表示重定向（3XX），橙色表示客户端请求错误（4XX），红色表示服务器错误（5XX）。平均错误率 = (4XX+5XX) / 总流量 × 100%。
