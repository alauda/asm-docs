---
weight: 10
sourceSHA: 3a0b9955e435a81f86ca14714066c807b29ccdc10f84b0d311e394a588b9cc92
---

# 介绍

## EnvoyFilter 介绍

EnvoyFilter API 是 Istio 服务网格中的一种强大定制机制，能够对 istiod 生成的 Envoy 代理配置进行细粒度控制。此功能专为高级用户设计，允许对特定的 Envoy 配置字段进行修改、插入自定义过滤器，甚至可以添加全新的监听器或集群。尽管提供了无与伦比的灵活性，但 EnvoyFilter 的使用需要谨慎，因为不当的配置可能会影响网格的稳定性。

EnvoyFilter 资源在工作负载中是以累加的方式应用的。多个过滤器可以共存于同一命名空间，应用顺序遵循以下层级：首先是[根配置命名空间](https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig)中的所有 EnvoyFilter，然后是工作负载特定命名空间中的那些。

## 优势

EnvoyFilter 的核心优势包括：

- **高级配置灵活性**\
  Enables direct manipulation of Envoy proxy settings beyond Istio's standard networking APIs. This allows implementation of protocol-specific optimizations, custom retry logic, or experimental features not yet natively supported by Istio.

- **细粒度工作负载控制**\
  Supports targeted customization using workload selectors, letting operators apply specific configurations to particular services or gateways without affecting the entire mesh.

- **与 Istio 集成**\
  Seamlessly integrates with Istio's control plane while maintaining compatibility with existing Istio resources like VirtualServices and DestinationRules.

- **协议可扩展性**\
  Facilitates insertion of custom Envoy filters (L4/L7) to handle proprietary protocols or implement specialized traffic handling logic at the proxy level.

## 应用场景

EnvoyFilter 主要用于以下场景：

- **协议扩展**\
  Implement custom protocol parsers or HTTP filters for specialized communication requirements not covered by Istio's default support.

- **流量操作**\
  Insert custom WASM filters to modify request/response headers, implement complex routing logic, or perform protocol translation at the proxy level.

- **安全增强**\
  Add custom authorization filters or implement request validation logic that requires deeper integration with Envoy's data plane.

- **可观察性扩展**\
  Configure custom access log formats, inject trace headers, or implement metrics collection filters for specialized monitoring requirements.

- **性能调优**\
  Override default Envoy configuration parameters (e.g., connection pool settings, timeouts) for specific services requiring optimized performance characteristics.

## 使用注意事项

使用 EnvoyFilter 时，请注意以下关键考虑事项：

- **版本兼容性**\
  EnvoyFilter 配置与特定的 Envoy 代理版本紧密相关。对 Istio 的控制平面或代理版本的任何更改都可能需要配置更新。始终测试跨版本升级的配置。

- **配置冲突**\
  应用于同一工作负载的多个 EnvoyFilter 按照创建时间戳顺序依次处理。冲突的配置可能会导致未定义的行为——确保过滤器的顺序经过仔细验证。

- **实现耦合**\
  某些配置可能依赖于 Istio 的内部实现细节。在可能的情况下，考虑使用标准 Istio API 的替代方法，以确保长期兼容性。

- **全局应用**\
  要在整个网格中应用配置，请在根命名空间中创建 EnvoyFilter **而不**使用工作负载选择器。谨慎使用此功能，以避免意外的副作用。

:::danger 操作警告
EnvoyFilter 的操作级别低于标准 Istio 资源。尽可能优先使用原生 Istio API（VirtualService, DestinationRule），并将 EnvoyFilter 保留给需要通过代理级别自定义无法通过更高级别抽象实现的用例。
:::
