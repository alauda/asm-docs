---
weight: 90
sourceSHA: f9b1cbff036eb2c3c203c6602b5facdf176fdbc6e761783c5ba2fedc197b70a6
title: 性能
---

Sidecar 的性能依赖于许多因素，例如：

- 客户端连接数

- 目标请求速率

- 请求大小和响应大小

- 代理工作线程数

- 协议

- CPU 核心数

代理过滤器的数量和类型，特别是与遥测 v2 相关的过滤器。这些因素对延迟、吞吐量以及代理的 CPU 和内存消耗有重要影响。

## CPU 和内存消耗

由于 Sidecar 代理在数据路径上执行额外的工作，因此它消耗 CPU 和内存。根据 Istio 1.12.3，代理每处理 1000 个请求每秒大约消耗 0.5 vCPU。

代理的内存消耗取决于代理持有的总配置状态。大量的 Listener、集群和路由会增加内存使用。

由于代理通常不会缓冲通过的数据，请求速率不会影响内存消耗。

## 额外延迟

由于 Istio 在数据路径上注入 Sidecar 代理，延迟是一个重要的考虑因素。Istio 向代理添加了身份验证过滤器、遥测过滤器和元数据交换过滤器。每增加一个过滤器都会增加代理内部的路径长度，从而影响延迟。

Envoy 代理在响应发送给客户端后收集原始遥测数据。为请求收集原始遥测数据所花费的时间不会计入完成该请求的总时间。但是，由于工作线程在处理请求，因此它不会立即开始处理下一个请求。这个过程增加了下一个请求的队列等待时间，并影响了平均延迟和尾延迟。实际的尾延迟取决于流量模式。

在服务网格内部，请求会经过客户端代理，然后再经过服务器代理。在 Istio 1.12.3 的默认配置下（即具有遥测 v2 的 Istio），这两个代理分别增加大约 1.7 毫秒和 2.7 毫秒的 90 百分位和 99 百分位延迟，超出基线数据平面延迟。

## 调整 Sidecar 资源配额（CPU 和内存）

### 集群维度

在服务网格的集群级别配置中，可以为集群设置默认的 Sidecar 资源配额（CPU 和内存）。当用户添加服务时，此配置将默认用作 Sidecar 的资源配额。

具有平台管理权限的用户可以导航到服务网格详细信息页面，在 **配置** 标签下，通过更新 **集群维度配置** 来调整默认的 Sidecar 资源配额。

### 指定服务

- 添加新服务时，设置特定的 Sidecar 资源配额（CPU 和内存）。

- 访问已添加服务的详情页面后，导航到 **详细信息** 标签并在 **Sidecar** 中更新 Sidecar 配置。
