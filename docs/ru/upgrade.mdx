---
weight: 30
i18n:
  title:
    en: Upgrade
    ru: Обновление
title: Обновление
sourceSHA: 8430a28bb9319b7e91113118760dfd8ea5654267f0685e1223fb32db9a2dd9a1
---

## Установка последней версии плагина Global Alauda Servie Mesh Essentials Cluster

Пожалуйста, посетите [Alauda AI Essentials](./install/asm-essentials.mdx) для инструкций по установке.

## Обновление компонентов бизнес-кластера

### <span id="ref">Перед обновлением</span>

Платформа предоставляет обновление "канарейка" для Istio в сервисной сетке, при котором новая версия компонента istiod сначала разворачивается. Как только все данные плоскости обновлены, старая версия компонента istiod выводится из эксплуатации.

С учетом сильной зависимости между версиями Istio и Kubernetes, убедитесь, что текущая версия Kubernetes кластера соответствует требованиям к обновлению Istio перед тем, как приступить к обновлению Istio, чтобы успешно завершить обновление "канарейка".

В таблице ниже представлены поддерживаемые пути обновления Istio для текущей версии платформы и необходимые версии Kubernetes для этих путей.

| Поддерживаемые пути обновления Istio | Требования по версиям Kubernetes         |
| ------------------------------------- | ---------------------------------------- |
| Istio с 1.20 на 1.22                  | Версия Kubernetes `1.27`, `1.28`        |
| Istio с 1.18 на 1.22                  | Версия Kubernetes `1.27`                |

**Примечание**:

{/* TODO: [Upgrade Components](@console-platform-docs/zh/platform-usermanual/clusterall/1cluster/11upgrade/) */}

- В таблице описаны только основные версии Istio и Kubernetes; незначительные версии не влияют на совместимость.
- Вы можете проверить текущие версии Istio и Kubernetes, работающие в кластере, перейдя в список **Компоненты**.
- Если текущая версия Kubernetes кластера ниже необходимой версии для обновления Istio, вам необходимо обновить Kubernetes до совместимой версии через [Upgrade Components]().
- Для получения дополнительной информации, пожалуйста, обратитесь к [Поддерживаемым версиям Kubernetes для Istio](https://istio.io/latest/docs/releases/supported-releases/).

### Процесс обновления

Полный процесс обновления сервисной сетки включает в себя следующие шаги:

1. [Обновите компоненты, не относящиеся к Istio, в сервисной сетке кластера](#component), такие как asm operator, flagger operator и т.д.
2. [Разверните новую версию istiod в кластере](#newistiod).
3. [Проверьте, есть ли EnvoyFilters в кластере](#envoyfilters).
4. [Обновите все плоскости данных Istio в кластере](#data-planes).
5. [Выведите из эксплуатации старую версию istiod в кластере](#oldistiod).

### Операции по обновлению

#### <span id="component">Обновление не-Istio компонентов сервисной сетки в кластере</span>

{/* TODO: [Upgrade Components](@console-platform-docs/zh/platform-usermanual/clusterall/1cluster/11upgrade/) */}

1. В левом меню **Управление платформой** нажмите **Сервисная сетка** > **Сетки**.
2. Нажмите на `Название сервисной сетки`, которую нужно обновить, чтобы войти в детали сетки.
3. В области **Развертывание сетки** на странице деталей сетки есть список кластеров, в которых была развернута сервисная сетка. Нажмите на `Название кластера`, чтобы открыть страницу деталей кластера в новой вкладке.
4. Переключитесь на **Компоненты** на странице деталей кластера и нажмите "обновить", чтобы обновить не-Istio компоненты сервисной сетки в кластере до последней версии. Для получения подробной документации по обновлению компонентов смотрите [Upgrade Components]().

**Примечание**: Не-Istio компоненты сервисной сетки включают asm, Flagger Operator, Asm Operator, Jaeger Operator.

#### <span id="newistiod">Развертывание новой версии istiod</span>

**Примечание**: Перед развертыванием новой версии istiod, пожалуйста, ознакомьтесь с [Перед обновлением](#ref), чтобы убедиться, что версия Kubernetes кластера соответствует требованиям пути обновления.

1. Вернитесь на страницу деталей сетки, и в области **Развертывание сетки** нажмите кнопку **Обновить** справа от `Версии Istio` соответствующего кластера. В всплывающем окне будет отображен путь обновления для Istio.
2. Нажмите кнопку **Обновить** в всплывающем окне.

#### <span id="envoyfilters">Проверьте наличие EnvoyFilters в кластере</span>

1. В левом меню **Управление платформой** нажмите **Сервисная сетка** > **EnvoyFilter**.

   **Примечание**: Если на платформе есть несколько сервисных сетей, вы можете переключить сервисную сетку на ту, где находится кластер, через верхнюю навигационную панель.

2. Проверьте, есть ли данные в списке EnvoyFilter.
   - Если данные не найдены, проверка завершена.
   - Если данные найдены, свяжитесь с создателем EnvoyFilter для адаптации всех EnvoyFilters к новой версии Istio или свяжитесь с технической поддержкой.

#### <span id="data-planes">Обновите все плоскости данных Istio в кластере</span>

Плоскости данных Istio в кластере включают Sidecars, ingress gateways и egress gateways.

**Метод 1: Обновление через интерактивный инструмент командной строки**

Интерактивный инструмент командной строки может одновременно обновить все Sidecars и шлюзы в кластере. Этот метод подходит для пользователей, знакомых с операциями в командной строке, особенно для тех, кто нуждается в быстром обновлении всего кластера сразу.

```bash
kubectl -ncpaas-system exec -it deploy/asm-controller -- /app/asm-controller bfg rollout
```

**Примечание**: Вы также можете использовать параметр быстрого обновления без подтверждения для выполнения обновления.

```bash
kubectl -ncpaas-system exec -it deploy/asm-controller -- /app/asm-controller bfg rollout --no-prompt
```

**Примечание**: Процесс поэтапного обновления шлюзов ingress и egress включает в себя предварительное удаление старых Pods, а затем создание новых Pods, пока все Pods не будут обновлены до новой версии образа плоскости данных. Поэтому, если у шлюза есть только один Pod, он будет недоступен во время обновления шлюза.

**Метод 2: Обновление через интерфейс пользователя**

Обновление через интерфейс пользователя позволяет производить массовые обновления по разным пространствам имен или указывать отдельную службу/шлюз для обновления. Этот метод подходит для пользователей, предпочитающих работать в визуальном интерфейсе, особенно для тех, кто нуждается в гибком выборе целей обновления.

**Обновление шлюзов ingress и egress**

1. В левом меню нажмите **Сервисная сетка** > **Шлюзы**.
   **Примечание**: В списке шлюзов кластера значок ![](/zh/img/00feature.png), расположенный справа от **Версии Istio**, указывает, что прокси для плоскости данных шлюза может быть обновлен.
2. Нажмите кнопку **Обновить** справа от **Версии Istio**, затем **Подтвердить**.

**Обновление Sidecars**

1. В левом меню **Управление платформой** нажмите **Сервисная сетка** > **Сетки**.
2. Нажмите на `Название сервисной сетки`, для которой необходимо обновить Sidecars, чтобы войти в детали сетки.
3. В области **Пространства имен** на странице деталей сетки есть список пространств имен, управляемых сервисной сеткой. Нажмите на `Название пространства имен`, чтобы открыть **Сервисную сетку** в новой вкладке и войти в пространство имен, где находится Sidecar.
   **Примечание**: Выполняйте обновления Sidecar во всех пространствах имен последовательно.
4. В левом меню нажмите **Список служб**.
   **Примечание**: Когда рядом с `Название службы` появляется значок ![](/zh/img/00feature.png), это означает, что Sidecar службы может быть обновлен.
5. Нажмите **Массовое обновление Sidecars**.
   **Примечание**: Чтобы обновить отдельную службу, нажмите кнопку **Обновить** справа от значка ![](/zh/img/00feature.png) для записи службы.
6. Выберите все, одну или несколько служб и нажмите **Обновить**.
   **Примечание**: Платформа обновит Sidecar службы, выполняя поэтапное обновление Pods с разными текущими и целевыми версиями Sidecar. Если обновление не удалось, проверьте события группы контейнеров на Контейнерной платформе, чтобы понять причины сбоя или попробуйте **Повторное обновление**.

**Примечание**: Sidecar обновляется путем поэтапного обновления развертывания службы для завершения обновления образа плоскости данных Pod. Поэтому, если служба имеет длительные соединения, во время поэтапного обновления Pod может произойти краткая остановка службы.

#### <span id="oldistiod">Вывод старой версии istiod из эксплуатации в кластере</span>

Старая версия istiod в кластере может быть выведена из эксплуатации только после того, как все плоскости данных Istio в кластере были обновлены.

**Внимание**:

- Если старая версия istiod в кластере не будет выведена из эксплуатации, вы не сможете использовать функции добавления кластера и конфигурации Sidecar в сервисной сетке.
- Когда на платформе есть новая версия для обновления, если какой-либо кластер не вывел старую версию istiod из эксплуатации, платформа не сможет быть обновлена.
- В мультикластерной сервисной сетке старая версия istiod в кластерах может быть выведена из эксплуатации последовательно только после завершения обновления плоскости данных Istio во всех кластерах.

**Шаги**

1. Вернитесь на страницу деталей сетки, и в области **Развертывание сетки** нажмите кнопку **Вывести старую версию** справа от `Версии Istio` соответствующего кластера. Всплывающее окно **Вывести старую версию** будет отображено.
2. Нажмите кнопку **Подтвердить** в всплывающем окне.

**Примечание**: Если в кластере есть плоскости данных, которые не были обновлены, после нажатия **Вывести старую версию** во всплывающем окне отобразятся шлюзы ingress, шлюзы egress и Sidecars в кластере, которые не были обновлены, что позволит быстро отследить плоскости данных, которые необходимо обновить.
