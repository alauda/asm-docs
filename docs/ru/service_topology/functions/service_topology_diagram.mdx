---
weight: 10
sourceSHA: 47e291b09028e9f5337a2cb1a49059c664867cb8916c42ed44acd5041c2da5f8
---

# Диаграмма топологии сервиса

В данной статье представлен процесс просмотра топологии сервиса.

## Предварительные условия

Чтобы просмотреть топологию сервиса, вам необходимо:

- Для сервисов Istio: убедитесь, что служба имеет инжектированный Sidecar. Подробную информацию см. в [Добавление сервиса ServiceMesh](../../microservice/add-service.md#add-servicemesh-service).
- Для сервисов OpenTelemetry: убедитесь, что служба имеет инжектированный Java Agent OpenTelemetry. Подробную информацию см. в [Добавление сервиса OpenTelemetry](../../microservice/add-service.md#add-opentelemetry-service).

## Быстрый старт

В левой навигационной панели нажмите на **Топология сервиса**.

## Основное отображение страницы

Страница четко отображает отношения вызовов между службами, где каждый узел и соединительная линия различаются по цвету.

- Соединительные линии представляют вызовы между службами, цвет которых изменяется в зависимости от процента успешности вызовов. Серые линии указывают на отсутствие трафика для этих вызовов в выбранный период времени.
- Узлы представляют отдельные службы, цвет которых определяется долей Pod обслуживания.

Для получения подробной легенды значков узлов, цветовых порогов для узлов и соединительных линий и их значений смотрите легенду, представленную в верхнем левом углу диаграммы топологии.

Когда служба (и ее развертывание, Pod) или шлюз входа, связанный с правилом сигнала, вызывает сигнализацию, диаграмма топологии будет отмечать тревожащую службу или шлюз входа как **Тревога** (<img src="../../../en/service_topology/assets/firing.png" style={{display: "inline", verticalAlign: "middle"}} />). Щелкнув по маркеру <img src="../../../en/service_topology/assets/firing.png" style={{display: "inline", verticalAlign: "middle"}} /> службы, вы перейдете на страницу **实时报警** для просмотра деталей тревожного правила.

По умолчанию диаграмма топологии автоматически обновляется каждые 5 секунд. Вы можете вручную обновить или задать интервал автоматического обновления:<br />**Ручное обновление**: Нажмите на <img src="../../../en/service_topology/assets/metric_refresh.png" style={{display: "inline", verticalAlign: "middle"}} /> в правом нижнем углу диаграммы топологии, чтобы вручную обновить данные;<br />**Установить интервал автоматического обновления**: Нажмите на время интервала рядом с <img src="../../../en/service_topology/assets/metric_refresh.png" style={{display: "inline", verticalAlign: "middle"}} /> в правом нижнем углу, чтобы установить интервал автоматического обновления.

## Просмотр топологии Istio Cross-Cluster

Если текущий проект связан с несколькими кластерами, управляемыми сетевым шлюзом, выбор **Cross-Cluster Topology** позволяет вам просмотреть топологическую диаграмму отношений вызовов служб и шлюзов входа, которые имеют инжектированные Sidecar во всех пространственных именах текущего сетевого шлюза и проекта, в пределах прав доступа к аккаунту.<br /><br />**Примечание**: Область просмотра зависит от прав доступа к данным учетной записи пользователя; только службы в одном пространственном имени поддерживают просмотр трассировки.<br />Например: Кластеры A и B управляются текущим сетевым шлюзом, при этом подпространства an1 и bn1 существуют в кластерах A и B соответственно, и у вас есть права на просмотр an1 и bn1. Когда вы входите в an1, чтобы просмотреть топологию службы, по умолчанию вы можете просматривать только диаграмму топологии вызовов всех служб в пространственном имени an1; когда вы выбираете **Все кластеры**, вы можете просмотреть диаграмму топологии вызовов всех служб внутри пространственных имен an1 и bn1, включая диаграмму топологии служб в an1, вызывающих службы в bn1.

## Просмотр топологии вызовов служб в указанном пространственном имени

Щелкните и выберите выпадающий список **Namespace** выше диаграммы топологии. Вы можете просмотреть топологию вызовов служб в указанном пространственном имени внутри текущего кластера. Настройка по умолчанию - Все пространства имен, отображающие отношения вызовов для всех управляемых пространств имен в кластере.

## Просмотр локальной диаграммы топологии

Вы можете **двойным щелчком** на узел (кроме узлов промежуточного ПО, отмеченных как “Host Unknown”), чтобы развернуть локальную топологию, сосредоточенную на этом узле. Это позволяет вам быстро просмотреть состояние и данные всех узлов в связи с вызовами выше и ниже целевого узла, помогая вам сосредоточиться на анализе ситуаций вызова конкретной службы.

## Просмотр подробной информации

Вы можете **щелкнуть** на узел/соединительную линию, чтобы развернуть панель деталей справа, где вы можете выполнить несколько действий.

### Просмотр трассировки

Когда вы щелкаете на **узле** или **соединительной линии**, панель деталей отображает **Просмотр трассировки**, и вы можете перейти на страницу **Трассировка**, чтобы просмотреть данные трассировки для текущей **службы** или **взаимосвязи вызовов**.

- Щелкните на узел > Просмотр трассировки: Это действие запрашивает все данные диапазона, сообщает интерактивный метод для вызванной службы в установленном диапазоне времени на диаграмме топологии. Например, если вы щелкаете на узел службыпод именем "client" и нажимаете **Просмотр трассировки**, система будет искать все диапазоны, принадлежащие службе с именем client в установленном диапазоне времени.
- Щелкните на соединительную линию > Просмотр трассировки: Это действие запрашивает данные диапазона, относящиеся к конкретной взаимосвязи вызовов в установленном диапазоне времени на диаграмме топологии. Например, если вы щелкаете на соединительной линии от сервиса "client" к "server" и нажимаете **Просмотр трассировки**, система будет искать все диапазоны, где "client" является инициатором вызова, а "server" - вызываемым в установленном диапазоне времени.

**Примечание**: Функция Просмотр трассировки поддерживает разные типы служб в зависимости от вашей реализации сетевого шлюза:

- Для Istio: Поддерживаются только узлы **ServiceMesh Service**, **Ingress Gateway** и **Egress Gateway**.
- Для OpenTelemetry: Поддерживаются узлы **OpenTelemetry services** и **middleware** (такие как базы данных и очереди сообщений).

Если вы щелкнете на узлы типов, не поддерживаемых, или на соединительные линии, которые включают неподдерживаемые узлы, вы не сможете перейти на страницу Трассировки.

### Просмотр мониторинга трафика службы

Когда вы щелкаете на узлы **ServiceMesh Service**, **OpenTelemetry Service**, **Ingress Gateway** или **Egress Gateway**, нажмите на **Просмотр мониторинга трафика** в панели деталей, чтобы перейти на страницу **Мониторинг**, чтобы просмотреть подробные данные мониторинга для текущей службы.

### Просмотр информации о трафике

**Примечание**:

- Панель информации о трафике только агрегирует данные трафика, управляемые Sidecar, исключая данные трафика из коммуникаций с неизвестными клиентами (трафик, не управляемый Sidecar). Вы можете посетить страницу **Подробности службы** или **Мониторинг**, чтобы просмотреть полные данные о трафике.
  
- Когда платформа собирает данные о трафике, если у клиента инжектированный Sidecar, скорость выборки трафика совпадает с частотой выборки цепочки вызовов, заданной в сетевом шлюзе; в противном случае скорость выборки составляет 100%.

- Временной диапазон запроса для данных о трафике зависит от конфигурации хранения данных системы мониторинга, интегрированной с сетевым шлюзом. Например, если система мониторинга (такая как Prometheus) настроена на сохранение данных за последние 7 дней, система может отображать данные о трафике только за последние 7 дней, когда временной диапазон запроса превышает 7 дней.

Когда вы щелкаете на **узле** или **соединительной линии**, в панели деталей вы можете просмотреть диаграммы трафика для текущей **службы** или **взаимосвязи вызовов**. Объяснения диаграмм для разных протоколов следующие:

#### Протоколы HTTP/HTTP2/gRPC

| Параметр                     | Описание                                                                                                                                                                                                                                                                                                                                                         |
| ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Входящий/Исходящий трафик** | Общий объем входящих/исходящих запросов в пределах установленного временного диапазона, и доля трафика по коду статуса HTTP (Normal/2xx, 3xx, 4xx, 5xx).<br />Наведите курсор на столбец диаграммы, чтобы просмотреть долю трафика для каждой категории.                                                                                                                                     |
| **Входящий/Исходящий RPS**     | Общая входящая/исходящая RPS трафика (Requests Per Second) и количество ошибочных входящих/исходящих запросов в установленном временном диапазоне.<br />**RPS = Количество запросов в установленном диапазоне времени / Длительность запроса (с)**.                                                                                                                                                    |
| **Трафик**                   | Общее количество запросов между службами в установленном временном диапазоне, а также количество и доля запросов по коду статуса HTTP (Normal/2xx, 3xx, 4xx, 5xx), NR (No Response).<br />Наведите курсор на столбец диаграммы, чтобы просмотреть количество и долю запросов для каждой категории.                                                                                  |
| **RPS**                       | Общая RPS трафика (Requests Per Second) и ошибочная RPS трафика в установленном временном диапазоне.                                                                                                                                                                                                                                                                      |
| **Время ответа**             | Время ответа на запросы между службами или в самой службе, представленное как среднее значение, TP 50, TP 95, TP 99.<br />TP (Top Percentile) xx указывает на минимальную продолжительность, необходимую для удовлетворения xx процентов сетевых запросов, обычно используется в сценариях мониторинга производительности системы.<br />Наведите курсор на кривую, чтобы просмотреть время ответа за определенный период. |

#### Протокол TCP

| Параметр                     | Описание                                                                                                                                                                                                                                                                |
| ----------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Входящий/Исходящий трафик** | Общий размер входящего/исходящего трафика в байтах в пределах установленного временного диапазона.                                                                                                                                                                                              |
| **TCP Соединения**           | Общее количество соединений.<br />**Коэффициент ошибок = Количество неудачных соединений / Общее количество соединений**<br />**Коэффициент успеха = Количество успешных соединений / Общее количество соединений**<br />Наведите курсор на столбец диаграммы, чтобы просмотреть количество соединений для разных категорий. |
| **Трафик**                   | Общий размер трафика в байтах между службами в установленном временном диапазоне.                                                                                                                                                                                               |
| **Входящий/Исходящий (Bps)**   | Скорость передачи байтов (байт в секунду) входящего/исходящего сетевого трафика служб.                                                                                                                                                                                    |

#### **Информация о Middleware**

Когда вы щелкаете на **соединительной линии**, соединяющей **OpenTelemetry service** с **сервисом промежуточного ПО**, вы можете просмотреть следующую информацию:

**Информация об узле**

| Тип              | Описание                                                                                                                                                                   |
| ----------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **База данных**      | Тип: тип базы данных, такой как MySQL, Oracle и др.<br />Хост: предоставляет адрес хоста базы данных<br />Подробности: предоставляет имя пользователя базы данных, имя базы данных и другую информацию |
| **Очередь сообщений** | Тип: тип очереди сообщений, такой как RabbitMQ, Kafka и др.                                                                                                                       |

**Примечание**: Для получения полного списка поддерживаемых типов промежуточного ПО смотрите [Типы узлов](../concepts/insight_node_types.mdx#opentelemetry-node-types).

**Информация о трафике**

Относится к общему количеству запросов, сделанных службой OpenTelemetry к промежуточному ПО в установленном временном диапазоне.
