---
title: Основные концепции
description: 'Введение в основные концепции, связанные с продуктами Service Mesh.'
weight: 1
sourceSHA: 0906406ef40350b108e50da7f44cfd8d85193349ff681287d8a3303275363bd1
---

## Service Mesh

Service Mesh - это независимый и настраиваемый слой инфраструктуры, добавляемый к приложению. Он используется для управления и контроля связи между микросервисами, предоставляя возможности для управления трафиком сервисов, мониторинга сервисов, контроля безопасности доступа к сервисам и выпуска сервисов.

В традиционной архитектуре микросервисов связь между сервисами обычно обрабатывается непосредственно в коде приложения, что увеличивает сложность и связность. Service Mesh вставляет легковесный прокси (Envoy, развернутый в качестве контейнера бокового пода для каждого сервисного пода), чтобы управлять и контролировать межсервисную связь. Эти прокси отделены от кода приложения и выполняют такие задачи, как маршрутизация запросов, балансировка нагрузки, восстановление после сбоев, контроль трафика и безопасность. Это позволяет разработчикам сосредоточиться на бизнес-логике, не беспокоясь о механизмах и функциональных возможностях связи.

Внедрение Service Mesh позволяет разработчикам лучше управлять и контролировать связь между приложениями микросервисов и добавлять новые функции без изменения кода приложения. Service Mesh поддерживает множество инфраструктур, таких как виртуальные машины и контейнеры, и может быть интегрирован с платформами оркестрации контейнеров (например, Kubernetes) для предоставления лучшего опыта контейнеризированной архитектуры микросервисов в эпоху облачного нативного программного обеспечения.

## Istio

[Istio](https://istio.io/latest/about/service-mesh/) - это открытый сервис Mesh, который бесшовно интегрируется в существующие распределенные приложения для предоставления управления трафиком, соблюдения политик, сбора телеметрии и обеспечения безопасности. Istio предлагает комплексные возможности управления сервисами для архитектуры микросервисов, поддерживает множество языков и в основном использует Kubernetes в качестве реестра сервисов.

Istio предоставляет мощные функции для защиты, соединения и мониторинга сервисов единым и эффективным образом. С помощью Istio вы можете достичь балансировки нагрузки, межсервисной аутентификации и мониторинга с минимальными или нулевыми изменениями кода сервиса. Он предлагает следующие ключевые функции:

- Безопасная межсервисная связь внутри кластера, включая шифрование TLS, аутентификацию на основе идентичности и авторизацию.
- Автоматическая балансировка нагрузки для HTTP, gRPC, WebSocket и TCP трафика.
- Тонкая настройка поведения трафика с помощью богатых правил маршрутизации, повторных попыток, переключения на резерв и инъекций сбоев.
- Плаuggable policy layer и API конфигурации для контроля доступа, ограничения скорости и управления квотами.
- Автоматический сбор метрик, журналов и трассировок из всего трафика в кластере, включая входящий и исходящий трафик.
- Масштабируемость для удовлетворения различных требований развертывания. Управляющая плоскость работает на Kubernetes, и вы можете добавлять приложения, развернутые в кластере, в mesh, расширять mesh на другие кластеры и даже подключаться к виртуальным машинам или другим конечным точкам вне Kubernetes.

Архитектура Istio показана ниже.

<img src="/en/33servicemesh.svg" width="600" />

**Управляющая плоскость**

Управляющая плоскость Istio отвечает за управление и настройку прокси. Она связывается с прокси в плоскости данных (Envoy), чтобы отправлять конфигурации и инструкции для контроля сервисного трафика, управления безопасностью и сбора и обработки данных телеметрии. Это позволяет администраторам и разработчикам централизованно управлять всей службой mesh с гибкими настройками.

**Плоскость данных**

Плоскость данных Istio состоит из набора интеллектуальных прокси (Envoy), развернутых и работающих в качестве контейнеров бокового пода в сервисных подах. Эти прокси отвечают за перехват, обработку и передачу всего трафика между сервисами.

Плоскость данных выполняет управление трафиком, восстановление после сбоев, обеспечение соблюдения политик безопасности и другие функции, чтобы обеспечить надежность и безопасность межсервисной связи. Она также обеспечивает богатые возможности мониторинга и трассировки, помогая разработчикам понимать и отлаживать поведение связи сервисов.

**Envoy**

[Envoy](https://istio.io/latest/docs/ops/deployment/architecture/#envoy) используется в качестве прокси для плоскости данных Istio и является единственным компонентом Istio, который взаимодействует с трафиком плоскости данных.

Envoy развернут и работает как контейнер бокового пода в сервисных подах, обрабатывая и передавая весь входящий и исходящий трафик для сервисов в сети mesh, предоставляя сетевые функции и функции управления, такие как контроль трафика, балансировка нагрузки, восстановление после сбоев и безопасность.

**Боковой под**

Шаблон бокового пода широко используется в микросервисах и контейнеризированных приложениях для повышения функциональности и производительности приложения путем добавления вспомогательных контейнеров или прокси рядом с основным контейнером приложения.

Envoy, который формирует плоскость данных Istio, развернут как контейнер бокового пода в сервисных подах.

**Шлюз сервиса**

Шлюзы сервиса включают шлюз выхода и шлюз входа, работающие на краю сети mesh для управления трафиком, входящим и выходящим из сети. Они позволяют вам указывать разрешенный трафик, который может покинуть или войти в сеть.

## OpenTelemetry

OpenTelemetry - это открытая платформа наблюдаемости, направленная на генерацию, обработку и передачу телеметрических данных, включая метрики, журналы и трассировки. Разработанная Фондом облачных вычислений (CNCF), она предоставляет набор стандартных протоколов и инструментов для отправки данных в любую платформу наблюдаемости. Основные компоненты OpenTelemetry включают:

- Коллектор: Получает, обрабатывает и экспортирует телеметрические данные.
- Языковые SDK: Позволяют генерировать телеметрические данные с использованием API OpenTelemetry на конкретных языках.
- Библиотеки инструментирования: Автоматически или вручную инструментируют приложения для сбора телеметрических данных.

OpenTelemetry поддерживает множество языков и сторонних реестров, предоставляя данные для наблюдаемости для JVM и промежуточного ПО. Он определяет общепринятые спецификации данных, что облегчает интеграцию с различными инструментами наблюдаемости с открытым исходным кодом.

## Техническое сравнение между Istio и OpenTelemetry

| Особенность/возможность       | Istio                                                                                                                                                                                                                                                                | OpenTelemetry                                                                                                                                                                                                                                                    |
| ------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Поддержка протоколов**      | Поддерживает протоколы gRPC, HTTP, TCP.                                                                                                                                                                                                                                  | Поддерживает HTTP, TCP и различные RPC-протоколы, такие как Dubbo, Redis и др.                                                                                                                                                                                         |
| **Управление сервисами**      | Предоставляет балансировку нагрузки, защиту от разрывов цепи, пул соединений, повторные попытки тайм-аутов и др.                                                                                                                                                         | Нет возможностей управления.                                                                                                                                                                                                                                      |
| **Маршрутизация сервисов**    | Предоставляет богатые правила и стратегии маршрутизации, такие как маршрутизация по весу, маршрутизация по заголовку запроса, зеркалирование трафика, инъекции сбоев и др.                                                                                        | Нет возможностей маршрутизации.                                                                                                                                                                                                                                         |
| **Топология и цепочки вызовов** | Отображает все узлы в сети, включая сервисы, шлюзы входа, записи сервисов и шлюзы выхода, исключая узлы промежуточного ПО.<br />Цепочки вызовов включают в себя диапазоны HTTP вызовов для сервисов с встроенными боковыми подами, содержащими данные, такие как URL, код состояния и др. | Отображает узлы, включая сервисы и промежуточное ПО, исключая шлюзы входа и выхода.<br />Цепочка вызовов включает данные HTTP-ссылок, данные внутренней цепочки вызовов методов и данные ссылок сервис-посредник. Данные диапазона также могут быть активно сообщены через SDK. |
| **Данные мониторинга**        | Предоставляет полные метрики трафика входящих и исходящих данных для сервисов.                                                                                                                                                                                    | Предоставляет полные метрики трафика входящих и исходящих данных для сервисов и метрики JVM.                                                                                                                                                                              |
| **Совместимость с реестрами** | Поддерживает Kubernetes в качестве реестра сервисов.                                                                                                                                                                                                                   | Поддерживает сторонние реестры и реестр Kubernetes.                                                                                                                                                                                                             |
| **Передача идентификатора трассировки** | Требует изменений кода для реализации передачи идентификатора трассировки.                                                                                                                                                                                          | Реализует автоматическую передачу идентификатора трассировки.                                                                                                                                                                                                                       |
| **Требования к ресурсам**     | Может потребовать больше вычислительных ресурсов, так как для каждого экземпляра сервиса требуется прокси Envoy.                                                                                                                                                          | Требует меньше дополнительных ресурсов, не требует прокси вместе с каждым экземпляром сервиса.                                                                                                                                                                    |

### Рекомендации по выбору

- **Управление сервисами**: Если требуется управление сервисами, Istio является лучшим выбором.
- **Наблюдаемость**: Если требуется поддержка сильной наблюдаемости, особенно для мониторинга JVM, OpenTelemetry более подходит.
- **Ограниченные ресурсы**: В условиях ограниченных ресурсов OpenTelemetry может быть более легким выбором, так как не требует прокси вместе с каждым экземпляром сервиса.
- **Поддержка нескольких языков и реестров**: Для сценариев, требующих поддержки нескольких языков и использования сторонних реестров, OpenTelemetry предлагает большую гибкость.
- **Неинвазивная передача идентификатора трассировки**: Если вы используете приложение на Java и хотите достичь неинвазивной передачи идентификатора трассировки для трассировки полного стека, использование OpenTelemetry для Java Agent является отличным выбором.

Каждая технология имеет свои уникальные преимущества и применимые сценарии. Выбор должен основываться на конкретных бизнес-потребностях, технологическом стеке и соображениях будущей масштабируемости и интеграции. В некоторых случаях обе технологии могут использоваться вместе для достижения комплексных решений по управлению сервисами и наблюдаемости.
