---
weight: 10
sourceSHA: 862b8bbae5246569618fd4840e2ed5027f085fd61965e2e14cb5929489d5a40d
---

# Управление внешними сервисами

## Введение

Позволяет интеграцию несетевых сервисов в управление сервисной сеткой для того, чтобы:

- Решить проблемы подключения в гибридном облаке
- Управлять трафиком для унаследованных систем
- Реализовать безопасный контроль выхода

Ключевая ценность: Единое enforcement политики для внутренних/внешних сервисов

## Возможности

• Поддержка протоколов уровня 4/7  
• Привязка шлюза выхода  
• Регистрация DNS/VIP адресов  
• Конфигурация множественных портов  

## Преимущества

- Согласованность протокола в разных средах  
- Изоляция трафика на уровне пространства имен  
- Фиксация протокола после создания  
- Максимум 5 портов на сервис  

## Создание внешних сервисов

### Шаг 1: Основная конфигурация

1. Перейдите в: **Service Mesh** > **External Services**
2. Выберите целевой кластер
3. Нажмите **Add External Service**

| Параметр         | Требование | Описание                           |
| ---------------- | ----------- | --------------------------------- |
| Протокол сервиса | Обязательно | HTTP/HTTPS/TCP                    |
| Адрес сервиса    | Обязательно | Домен/VIP для L7, список IP для L4 |
| Порты сервиса    | Обязательно | Макс. 5 портов                    |

### Шаг 2: Привязка шлюза выхода

1. Переключите **Bind Egress Gateway**
2. Настройте параметры:

| Параметр        | Пример значения | Ограничение        |
| ---------------- | --------------- | ------------------ |
| Пространство имен | istio-system    | Должно существовать |
| Назначенный порт  | 80:HTTP         | Совпадение протокола |
| Привязка пространства имен | All/Custom | Необходим боковой контейнер |

### Шаг 3: Перезапись запросов

Пример конфигурации:  
• Исходный: `http://www.example.com:80`  
• Целевой: `www.example123.com:8080/v1/service1`  

---

# Конфигурация политики балансировки нагрузки

## Введение

Оптимизирует распределение трафика для внешних сервисов путем:

- Предотвращения перегрузки конечных точек
- Поддержания согласованности сессий
- Обеспечения настройки с учетом специфики протокола

Ключевая ценность: Гарантия доступности 99.9%

## Возможности

• 4 алгоритма балансировки нагрузки  
• Поддержка постоянства HTTP-заголовков/исходного IP/куки  
• Интеграция проверки состояния  
• Оптимизация по протоколу  

## Преимущества

- Продолжительность сессии для сервисов с состоянием  
- Автоматический механизм переключения при сбое  
- Осведомленность о протоколе L4/L7  
- Соблюдение требований GDPR к маршрутизации  

## Шаги создания политики

### Шаг 1: Доступ к интерфейсу политики

1. Выберите целевой внешний сервис
2. Перейдите в: **Policy** > **Create Policy** > **Load Balancing**

### Шаг 2: Выбор алгоритма

| Алгоритм       | Поддержка протокола | Описание                      |
| --------------- | -------------------- | ----------------------------- |
| Наименьший запрос | HTTP/HTTPS          | Выбор из 2 здоровых экземпляров |
| Случайный      | TCP/HTTP              | Случайное распределение       |
| Круговая выписка | TCP/HTTP            | Циклическое распределение     |
| Сессия        | HTTP/HTTPS            | Постоянство сессии           |

### Шаг 3: Настройка сессии

**Постоянство HTTP-заголовков**

| Параметр    | Пример     |
| ------------ | ---------  |
| Имя заголовка | User-Agent |

**Настройки куки**

| Параметр | Требование      |
| --------- | ---------------- |
| name      | Обязательно     |
| ttl       | 300-3600 секунд |

---

# Реализация политики размыкателя цепи

## Введение

Защищает сервисы следующим образом:

- Автоматически изолирует неисправные конечные точки
- Ограничивает количество одновременных соединений
- Управляет повторными запросами

Ключевая ценность: Предотвращает каскадные сбои

## Возможности

• Обнаружение ошибок 5xx  
• Динамическая продолжительность изоляции  
• Ограничения пула соединений  
• Механизм частичного восстановления  

## Преимущества

- Прогрессивное повторное введение хоста  
- Оптимизация протокола HTTP/2  
- Встроенный мониторинг состояния  
- Снижение числа сбоев на 80%  

## Конфигурация политики

### Шаг 1: Доступ к интерфейсу политики

1. Выберите целевой сервис
2. Перейдите в: **Policy** > **Create Policy** > **Circuit Breaker**

### Шаг 2: Настройки порогов

| Параметр           | По умолчанию | Влияние               |
| ------------------ | ------------ | --------------------- |
| Последовательные ошибки | 5             | Чувствительность    |
| Интервал проверки     | 30с          | Частота обнаружения   |
| Базовая изоляция     | 1м           | Начальная изоляция    |
| Макс. изоляция       | 30%          | Порог безопасности    |

### Шаг 3: Проверка

Процесс авто-проверки платформы:

1. Регулярные проверки состояния (каждые 30s)
2. Изоляция неисправного экземпляра (макс. 30%)
3. Прогрессивная продолжительность изоляции
4. Автоматический механизм восстановления
