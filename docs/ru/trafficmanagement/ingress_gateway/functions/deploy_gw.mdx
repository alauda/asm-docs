---
weight: 10
sourceSHA: 66b33238cd4fe10f49de9dafe007a91ed895469c6a26cce5c81e3c80bbf0cdbe
---

# Развертывание шлюза Ingress

## Введение

Развертывание шлюза Ingress обеспечивает безопасный внешний доступ к ресурсам сервисной сетки следующим образом:

- Обеспечение специализированных точек входа для север-юг трафика
- Поддержка гибких методов экспозиции (LoadBalancer/NodePort)
- Включение конфигураций слушателей, специфичных для протокола
- Изоляция компонентов шлюза от управляющей плоскости

Основная ценность: Безопасное и масштабируемое управление входящим трафиком

## Особенности

- Поддержка многопротокольных слушателей (HTTP/HTTPS/TCP)
- Модусы развертывания шлюзов: совместный/выделенный
- Интеграция с облачными провайдерами LB (AWS ELB, MetalLB и др.)
- Резервирование NodePort для bare-metal сред

## Преимущества

- **Изоляция безопасности**: Развертывание в пространствах имен, не относящихся к управляющей плоскости
- **Готовый к многим облакам**: Поддержка основных решений облачного LB
- **Гибкость портов**: Настраиваемые порты сервиса/узла
- **Контроль доступа**: Управление видимостью на уровне пространства имен

## Развертывание шлюза через LoadBalancer

### Шаг 1: Инициация развертывания

1. Перейдите: **Сервисная сетка** > **Шлюз**
2. Выберите целевое кластер
3. Нажмите **Развернуть шлюз**

| Параметр    | Требование | Описание                   |
| ------------ | ----------- | --------------------------- |
| Имя шлюза   | Обязательно  | Соответствует DNS-1123     |
| Пространство имен | Обязательно  | Пространство имен, не относящееся к управляющей плоскости |
| Тип сервиса  | Автоустановка | LoadBalancer                |

### Шаг 2: Конфигурация протокола

```yaml
ports:
- protocol: HTTPS 
  port: 443
- protocol: TCP
  port: 3306
```

| Параметр  | Ограничения    |
| ---------- | -------------- |
| Протокол   | HTTP/HTTPS/TCP |
| Диапазон портов | 1-65535        |

### Шаг 3: Интеграция с облаком

Для Huawei Cloud ELB:

- Укажите ELB ID и тип\
  Для MetalLB:
- Проверьте доступные IP-адреса в **Управление сетью** > **Внешний адресный пул**

## Развертывание шлюза через NodePort

### Шаг 1: Настройка NodePort

1. Установите **Тип сервиса** на NodePort
2. Определите порты узлов:

| Протокол | NodePort | Ограничение          |
| -------- | -------- | ------------------- |
| HTTP     | 30080    | Уникальный в кластере |
| HTTPS    | 30443    | Не конфликтующий      |

### Шаг 2: Настройка внешнего прокси

Рекомендуемая архитектура:

```
Клиент → F5/HAProxy → NodeIP:NodePort → Шлюз Ingress
```

## Проверка

1. Получите страницу деталей шлюза
2. Подтвердите статус: **Работает**
3. Проверьте доступность конечной точки:

```bash
curl -I http://<EXTERNAL-IP>:<PORT>/healthz
```

## Операционные заметки

- Совместные шлюзы видны всем проектам кластера
- Выделенные шлюзы требуют изоляции проектов
- Завершение TLS требует отдельной конфигурации сертификатов
- Избегайте конфликтов портов с существующими сервисами
