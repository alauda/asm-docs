---
weight: 30
sourceSHA: 98109f2d053ef33b7aa87e2c31324c560be906a948ea41f58e00c6e0d08ade1a
---

# Конфигурация маршрутизации

## Введение

Конфигурация маршрутизации определяет правила маршрутизации входящего трафика и стратегии обработки для:

- Управления потоком запросов к бэкенд-сервисам
- Обеспечения манипуляции трафиком на основе путей
- Реализации поддержки кросс-доменных ресурсов (CORS)
- Управления перенаправлениями и переписываниями HTTP

Основное значение: Детальный контроль трафика для операций шлюза входящего трафика

## Возможности

- Соответствие префикса пути
- Возможности переписывания запросов
- Конфигурирование политики CORS
- Управление перенаправлениями HTTP
- Приоритизация нескольких правил

## Преимущества

**Безопасность**: Строгая проверка источника для CORS  
**Гибкость**: Параллельные стратегии переписывания/перенаправления  
**Соответствие**: Соответствие стандартам HTTP  
**Масштабируемость**: Неограниченная последовательность правил  

## Создание конфигурации маршрутизации

### Шаг 1: Доступ к интерфейсу маршрутизации

1. Перейдите в: **Service Mesh** > **Gateways**
2. Выберите целевой шлюз входящего трафика
3. Откройте вкладку **Gateway Route**
4. Щелкните **Create Routing Configuration**

### Шаг 2: Основные параметры

```yaml
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: product-route
spec:
  hosts:
  • "www.example.com"
  gateways:
  • main-gateway
```

| Параметр  | Обязательно | Ограничения                      |
|-----------|-------------|----------------------------------|
| Namespace | Да          | Область развертывания сервиса   |
| Hosts     | Да          | Должен соответствовать конфигурации шлюза |
| Match     | Да          | Шаблон префикса URI             |

### Шаг 3: Выбор стратегии

**Пример переписывания запроса**:

```yaml
http:
• match:
  • uri:
      prefix: /app/product
  rewrite:
    uri: /foo
```

**Конфигурация перенаправления**:

```yaml
redirect:
  uri: /new-location
  authority: new.example.com
  redirectCode: 301
```

**Взаимная исключительность**:

- Переписывание запроса и перенаправление не могут существовать одновременно
- Правило, которое совпадает последним, имеет приоритет

## Кросс-доменное совместное использование ресурсов (CORS)

### Конфигурация политики

```yaml
corsPolicy:
  allowOrigins:
  • exact: https://origin-site.com
  allowMethods:
  • GET
  • POST
  allowHeaders: X-Custom-Header
  maxAge: "86400"
```

### Параметры CORS

| Параметр  | Эквивалент HTTP заголовка     | Пример значения          |
|-----------|-------------------------------|-------------------------|
| Origins   | Access-Control-Allow-Origin    | `https://trusted.com`   |
| Methods   | Access-Control-Allow-Methods   | GET,POST                |
| Headers   | Access-Control-Allow-Headers    | X-API-Key               |
| Max-Age   | Access-Control-Max-Age         | 86400 (24ч)             |

## Ограничения конфигурации

### Ограничения хоста

- Поддерживаются только однородные маршруты для символа подстановки (`*`)
- Хосты, специфичные для домена, позволяют несколько маршрутов

### Приоритет правил

1. Правила оцениваются сверху вниз
2. Первое совпадение выполняет стратегию
3. Доступна настройка порядка перетаскиванием

## Проверка доступа

1. Используйте **External Access Address** из деталей маршрута
2. Проверьте с помощью curl:

```bash
curl -v -H "Origin: https://client.com" https://gateway-domain.com/app/product
```

## Заметки по управлению

- Администраторы проекта могут просматривать/изменять конфигурации
- Рекомендуется тестирование маршрутов перед развертыванием в производственной среде
- Мониторьте ошибки 4xx/5xx для выявления ошибок конфигурации
