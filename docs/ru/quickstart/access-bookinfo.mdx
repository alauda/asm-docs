---
title: Доступ к Bookinfo
weight: 30
sourceSHA: e412ab94c103ccd502dfacbdd9998a8c3871401310c4b1cb9aec1daf4a250ed8
---

Этот гайд поможет вам получить доступ к Bookinfo через Istio Ingress Gateway и проверить его функциональность. Ingress Gateway в этом руководстве использует классический Istio `VirtualService` API.

**Перед тем как начать, убедитесь, что:**

- [Приложение Bookinfo развернуто](quickstart/deploy-bookinfo.html).
- [Создана служебная сетка](install/create_service_mesh/index.html).
- Вам нужны права администратора платформы. Убедитесь, что ваша учетная запись имеет назначенную роль администратора платформы.

Чтобы упростить процесс настройки, этот учебник использует метод `NodePort` для доступа к Ingress Gateway, что исключает необходимость в `LoadBalancer`. Доступ к приложению Bookinfo будет осуществляться через IP-адрес узла и порт узла.

## Шаг 1: Развертывание Ingress Gateway

1. **Создание проектов и пространств имен**
   Перейдите на страницу **Управление проектами**, нажмите **Создать проект**, назовите его `platform` и выберите кластер, в котором находится приложение Bookinfo.
   В деталях проекта в левом навигационном панели нажмите **Namespace** и создайте пространство имен с именем `platform-gateway`.

2. **Развертывание Ingress Gateway**
   Перейдите в **Управление платформой**, затем в **Служебная сетка** > **Шлюзы** и нажмите **Развернуть шлюз**. Заполните параметры шлюза:

   - Основная информация: Назовите его `public-ingressgw`, тип шлюза `Ingress Gateway`, выбор типа шлюза: `Shared`, оставьте другие параметры по умолчанию.
   - Конфигурация развертывания: Выберите пространство имен `platform-gateway`, выберите метку узла `ingress:true`, оставьте другие параметры по умолчанию.
   - Сетевая конфигурация: Выберите `NodePort`, установите HTTP порт хоста на `30665`, HTTPS порт хоста на `30666`.
   - Проверка доступности портов: Выполните следующую команду, чтобы убедиться, что порты не заняты:

     ```bash
     kubectl get svc --all-namespaces -o custom-columns='NAMESPACE:.metadata.namespace,NAME:.metadata.name,TYPE:.spec.type,NODEPORT:.spec.ports[*].nodePort' | grep NodePort
     ```

## Шаг 2: Создание конфигурации шлюза

1. Перейдите на страницу деталей шлюза, переключитесь на вкладку **Конфигурация шлюза** и нажмите **Создать конфигурацию шлюза**.
2. Назовите его `public-ingressgw-gateway`, выберите порт `HTTP` `80`, установите хост на `*` и нажмите создать.

## Шаг 3: Создание виртуальных служб

1. Переключитесь на вкладку **Виртуальные службы**, нажмите **Создать конфигурацию маршрутизации**.
2. Назовите его `public-ingressgw-vs`, выберите пространство имен `platform-gateway`, выберите пункт назначения маршрута: `Namespace: demo-dev`, `Service: productpage`, `Port: 9080`.

## Тестирование трафика Ingress

1. Получите `GATEWAY_IP_PORT`:
   - Сначала найдите IP-адрес узла, на котором находится Ingress Gateway, выполнив следующую команду:

     ```bash
     kubectl get nodes -o wide
     ```

   - Используйте IP-адрес узла, комбинируя его с портом `30665`, чтобы получить `GATEWAY_IP_PORT`, например, `192.168.130.0:30665`.

2. Выполните следующую команду, чтобы проверить правильно ли работает Ingress Gateway:

   ```bash
   export GATEWAY_IP_PORT=<node_IP>:30665
   curl -k -s http://$GATEWAY_IP_PORT/productpage | grep -o "<title>.*</title>"
   ```

3. Ожидаемый вывод должен выглядеть как:

   ```bash
   <title>Приложение простого книжного магазина</title>
   ```
