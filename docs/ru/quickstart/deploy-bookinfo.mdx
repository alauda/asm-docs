---
title: Развертывание Bookinfo
weight: 20
sourceSHA: c10f390ae9caf58c4da28ddc622cf55a0ccc9919ea3fbb33e7502b89b9d77fd8
---

Этот гид поможет вам развернуть приложение Bookinfo в вашей среде и проверить успешность развертывания.

Прежде чем начать, убедитесь, что:

- У вас есть учетная запись **Customer Portal** с доступом на загрузку из **App Market**. Если у вас нет учетной записи, обратитесь в техническую поддержку.

## Шаг 1: Создание проекта и пространства имен Bookinfo

1. **Создайте проект и пространство имен**\
   В **Управлении проектами** нажмите **Создать проект**, назовите его `demo` и выберите кластер, в котором вы планируете развернуть приложение Bookinfo.
   После создания проекта перейдите на страницу деталей проекта. В левой навигационной панели нажмите **Пространства имен**, затем **Создать пространство имен**, назвав его `demo-dev`.\
   Если у вас уже есть подходящий проект и пространство имен для развертывания Bookinfo, вы можете пропустить этот шаг и заменить пространство имен в следующих командах на ваше собственное пространство имен.

   **Примечание**: Создание проекта требует прав администратора платформы. Если у вас нет необходимых прав доступа, обратитесь за помощью к администратору.

## Шаг 2: Скачивание ресурсов Bookinfo

1. **Войдите в систему и загрузите**\
   Войдите в **Customer Portal**, найдите "Bookinfo" в App Market и загрузите ресурсы.

## Шаг 3: Загрузка изображений

1. **Загрузите и извлеките пакет**\
   Загрузите загруженный пакет на сервер или ПК, который может подключаться к вашему реестру изображений. Извлеките пакет, чтобы получить следующие файлы:

   ```bash
   tar -xzvf <package>
   ```

   - `bookinfo-images-arm64.tar`: Изображения Bookinfo для архитектуры ARM.
   - `bookinfo-images-amd64.tar`: Изображения Bookinfo для архитектуры x86.
   - `push-images.sh`: Скрипт загрузки изображений, который автоматически обновляет ссылки на изображения в `bookinfo.yaml`.
   - `bookinfo.yaml`: YAML-файл для развертывания Bookinfo, включая конфигурации сервиса и развертывания.

2. **Установите разрешения для скрипта**\
   Назначьте права на выполнение скрипту:

   ```bash
   chmod +x push-images.sh
   ```

3. **Запустите скрипт для загрузки изображений**\
   Выполните следующую команду, чтобы загрузить изображения в ваш целевой реестр:

   ```bash
   # Пример ./push-images.sh ./bookinfo-images-amd64.tar 192.168.143.0:32767 true admin 'Aa123!@#' bookinfo-demo
   ./push-images.sh <source-image> <target-registry> <requires-auth> [username] [password] [harbor-project]
   ```

   **Объяснение параметров**:

   - `source-image`: Путь к файлу изображения.
   - `target-registry`: Адрес и порт реестра изображений. **Примечание**: Префикс не должен включать `https://` или `http://`.
   - `requires-auth`: Требуется ли аутентификация. Если не требуется, введите `false`; если требуется, введите `true` и предоставьте `username` и `password`.
   - `username`: Имя пользователя для реестра изображений.
   - `password`: Пароль для реестра изображений. **Рекомендуется**: заключить его в одинарные кавычки, чтобы избежать ошибок анализа командной строки из-за специальных символов в пароле.
   - `harbor-project`: Если используется реестр изображений Harbor, введите название проекта в Harbor; если используется Docker Registry, этот параметр можно оставить пустым.

## Шаг 4: Развертывание приложения Bookinfo

1. **Разверните с помощью kubectl**\
   Откройте платформу контейнеров или страницу управления платформой, затем нажмите на инструмент `kubectl` в правом нижнем углу.

2. **Примените файл YAML**\
   Используйте `vi` или другой терминальный редактор, чтобы вставить содержимое `bookinfo.yaml`, и выполните следующую команду:

   ```bash
   kubectl apply -f bookinfo.yaml -n <your-namespace>
   ```

3. **Проверьте успешность развертывания**

   - Убедитесь, что все Pods находятся в состоянии `Running`:

     ```bash
     kubectl get pods -n <your-namespace>
     ```

   - Убедитесь, что приложение доступно:

     ```bash
     kubectl exec "$(kubectl get pod -n <your-namespace> -l app=ratings -o jsonpath='{.items[0].metadata.name}')" \
         -n <your-namespace> -c ratings -- curl -s productpage:9080/productpage | \
         grep -o "<title>.*</title>"
     ```

     Ожидаемый вывод:

     ```bash
     <title>Simple Bookstore App</title>
     ```
