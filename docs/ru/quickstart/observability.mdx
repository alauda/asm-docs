---
title: Изучение возможностей наблюдаемости
weight: 40
sourceSHA: 405004896ab9622c2ec952eb64ac86f93a8aea3b9826e42fbdcdf2058938ce2e
---

Эта статья поможет вам разобраться, как использовать Istio для внедрения Sidecars в приложение Bookinfo и исследовать функции наблюдаемости.

**Перед тем как начать, убедитесь:**

- [Приложение-пример Bookinfo развернуто](quickstart/deploy-bookinfo.html).
- [Создана сетевая матрица](install/create_service_mesh/index.html).
- Вы [доступились к Bookinfo](quickstart/access-bookinfo.html).

## Шаг 1: Управление пространством имен

Перейдите в **Управление платформой**, выберите **Сетевая матрица** > **Сетевые матрицы** и нажмите на название сетевой матрицы, чтобы перейти на страницу с деталями. В разделе **Пространства имен** нажмите **Управляемое пространство имен**. Выберите `demo-dev` и нажмите **Подтвердить**.

## Шаг 2: Внедрение Sidecar

1. **Развертывание с помощью kubectl**\
   Откройте платформу контейнеров или страницу управления платформой и нажмите на инструмент `kubectl` в нижнем правом углу.

2. **Применение файла YAML**\
   Вставьте следующий скрипт в терминал и выполните его:
   ```bash
   #!/bin/bash
   apiVersion: asm.alauda.io/v1beta3
   kind: MicroService
   metadata:
     labels:
       app.cpaas.io/microservice-type: service-mesh
       asm.cpaas.io/isolatepod: enabled
     name: details
   spec:
     deployments:
     - name: details-v1
     services:
     - name: details
     sidecar:
       enabled: true
       resources:
         limits:
           cpu: 500m
           memory: 512Mi
         requests:
           cpu: 100m
           memory: 128Mi
   ---
   apiVersion: asm.alauda.io/v1beta3
   kind: MicroService
   metadata:
     labels:
       app.cpaas.io/microservice-type: service-mesh
       asm.cpaas.io/isolatepod: enabled
     name: ratings
   spec:
     deployments:
     - name: ratings-v1
     services:
     - name: ratings
     sidecar:
       enabled: true
       resources:
         limits:
           cpu: 500m
           memory: 512Mi
         requests:
           cpu: 100m
           memory: 128Mi
   ---
   apiVersion: asm.alauda.io/v1beta3
   kind: MicroService
   metadata:
     labels:
       app.cpaas.io/microservice-type: service-mesh
       asm.cpaas.io/isolatepod: enabled
     name: reviews
   spec:
     deployments:
     - name: reviews-v1
     services:
     - name: reviews
     sidecar:
       enabled: true
       resources:
         limits:
           cpu: 500m
           memory: 512Mi
         requests:
           cpu: 100m
           memory: 128Mi
   ---
   apiVersion: asm.alauda.io/v1beta3
   kind: MicroService
   metadata:
     labels:
       app.cpaas.io/microservice-type: service-mesh
       asm.cpaas.io/isolatepod: enabled
     name: productpage
   spec:
     deployments:
     - name: productpage-v1
     services:
     - name: productpage
     sidecar:
       enabled: true
       resources:
         limits:
           cpu: 500m
           memory: 512Mi
         requests:
           cpu: 100m
           memory: 128Mi
   EOF
   kubectl apply -f sidecar.yaml -n demo-dev
   rm sidecar.yaml
   ```

3. **Подтвердите успешное внедрение**\
   Перейдите к **Сетевой матрице**, и в **Службах** вы должны увидеть, что внедрение Sidecar `Включено` для всех четырех служб Bookinfo.

## Шаг 3: Изучение возможностей наблюдаемости

1. **Генерация трафика**\
   Для исследования возможностей наблюдаемости приложение Bookinfo должно получать трафик, чтобы Istio мог собирать метрики и трассировки от служб. Используйте следующий скрипт для генерации трафика.\
   \*\*Примечание: \*\* Замените `GATEWAY_IP_PORT` на фактический IP вашего входного шлюза. Мы ранее получили `GATEWAY_IP_PORT` в разделе \[Доступ к Bookinfo\].

   Сохраните следующий скрипт как `send-requests.sh`

   ```bash
   #!/bin/sh
   export GATEWAY_IP_PORT=192.168.130.0:30665
   while true; do
       result=$(curl -m 5 -s -o /dev/null -I -w "%{http_code}" "http://$GATEWAY_IP_PORT/productpage")
       echo date: $(date), status code: "$result"
       sleep 1
   done
   ```

   Сделайте скрипт исполняемым и запустите его:

   ```bash
   chmod +x send-requests.sh
   ./send-requests.sh
   ```

   Это будет отправлять запрос на страницу продуктов Bookinfo каждые 1 секунду. Через некоторое время вы сможете исследовать возможности наблюдаемости в интерфейсе.

2. **Топология службы**
   - После запуска скрипта генерации трафика в течение 1–5 минут перейдите к **Сетевой матрице** > **Топологии**. Здесь вы можете увидеть топологию, показывающую зависимости между входным шлюзом и четырьмя службами Bookinfo. Вы также можете просмотреть метрики, относящиеся к трафику и уровню ошибок на графике топологии.

   - Щелкните по связи между узлами `public-ingressgw` и `productpage` в топологии. **Информация о трафике** между ними появится с правой стороны топологии.

3. **Детали трассировки**
   - На странице **Информация о трафике** нажмите **Просмотреть трассировку**, чтобы открыть страницу деталей трассировки. Время запроса и параметры будут автоматически заполнены. Список Span слева отобразит данные Span, соответствующие условиям запроса.

   - Щелкните на любом Span, чтобы увидеть полные данные трассировки справа.

   - Нажмите **Просмотреть журнал** в данных трассировки, чтобы проверить устойчивые данные журналов Pods, участвующих в трассировке.
