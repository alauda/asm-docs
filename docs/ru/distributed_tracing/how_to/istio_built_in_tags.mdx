---
weight: 20
sourceSHA: 3d6fb5cec99ee40d56cd1f842a14e9a32ec2e2b7f14e6545abe0a9855c68b16a
---

# Использование встроенных тегов Istio Service в трассировке

## Обзор функции

Тег Span обозначает данные в виде пары ключ-значение, прикрепленные к Span, предоставляя специфическую контекстуальную информацию для каждого Span, что помогает разработчикам легче понимать и анализировать характеристики и влияние каждой операции.

Теги состоят из `ключа` и `значения`, где `ключ` должен быть строкового типа, а `значение` может быть строкой, булевым значением или числом.

## Категории тегов

### Метаданные

| Ключ                      | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                             | Пример значения |
| ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------- |
| **error**                | Указывает, является ли Span ошибкой.                                                                                                                                                                                                                                                                                                                                                                                                                 | `true`        |
| **internal.span.format** | Формат данных внутреннего Span.                                                                                                                                                                                                                                                                                                                                                                                                                   | `zipkin`      |
| **otel.status\_code**    | Статус Span.                                                                                                                                                                                                                                                                                                                                                                                                                                 | `ERROR`       |
| **span.kind**            | Тип Span:<br />- **client**: Указывает, что Span является исходящим вызовом (клиентская операция), т.е. клиент инициировал запрос к службе или ресурсу.<br />- **server**: Указывает, что Span является входящим вызовом (серверная операция), т.е. сервер получил и обработал запрос от клиента.<br />- **internal**: Указывает на внутреннюю операцию в приложении, не связанную с операциями с удаленным родителем или дочерним элементом. | `client`      |

### Информация о запросе HTTP

| Ключ                   | Описание                                                                                                                                                                   | Пример значения                                                                                                           |
| --------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| **guid:x-request-id** | Идентификатор запроса.                                                                                                                                                        | `e02b2515-44bb-95c1-859a-ea13718252ad`                                                                                  |
| **http.method**       | Метод HTTP-запроса.                                                                                                                                                      | `GET`                                                                                                                   |
| **http.protocol**     | Версия протокола, используемого для HTTP-запроса.                                                                                                                               | `HTTP/1.1`                                                                                                              |
| **http.status\_code** | Статусный код HTTP.                                                                                                                                                         | `200`                                                                                                                   |
| **http.url**          | URL запроса.                                                                                                                                                       | `http://details:9080/details/0`                                                                                         |
| **user\_agent**       | Заголовок User-Agent запроса - это характеристическая строка, которая позволяет серверу и партнерам идентифицировать приложение, операционную систему, поставщика и/или версию запрашивающего пользователя. | `Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, как Gecko) Chrome/123.0.0.0 Safari/537.36` |
| **request\_size**     | Размер запроса в байтах.                                                                                                                                             | `0`                                                                                                                     |
| **response\_flags**   | Флаги ответа Envoy (см. [RESPONSE\_FLAGS](https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage#)).                                      | `UH`, `DC`, `FI`, `NC` и т.д.                                                                                            |
| **response\_size**    | Размер ответа в байтах.                                                                                                                                            | `5300`                                                                                                                  |
| **upstreamURLPath**   | Путь запроса API.                                                                                                                                                  | -                                                                                                                       |

### Информация о запросе gRPC

| Ключ                    | Описание                                                                                                     | Пример значения                  |
| ---------------------- | --------------------------------------------------------------------------------------------------------------- | ------------------------------ |
| **grpc.authority**     | Хост целевой службы для запроса gRPC.                                                            | `grpc-svc-a:9090`              |
| **grpc.content\_type** | Тип содержимого протокола gRPC.                                                            | `application/grpc`             |
| **grpc.message**       | Описание состояния запроса.<br />**Примечание**: Видно только при возвращении ненулевого статус-кода.         | `DATA_LOSS`                    |
| **grpc.path**          | Путь запроса для интерфейса.                                                                             | `/helloworld.Greeter/SayHello` |
| **grpc.status\_code**  | Код статуса, диапазон от `0` до `15`. Код `0` указывает на правильное состояние; другие значения указывают на ошибку. | `15`                           |

### Служба

| Ключ                           | Описание                                                                                                                   | Пример значения                                                                                                                                                                                                     |
| ----------------------------- | ----------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **asm\_upstream\_cluster**    | Входная служба с включенной канарейкой, т.е. конечный сервис, который фактически доступен из нижестоящей службы (клиент). | `details-canary.bookinfo-ns.svc.cluster.local` : Указывает на то, что после включения канарейки для службы `details` нижестоящая служба фактически обращается к `details-canary.bookinfo-ns.svc.cluster.local`. |
| **component**                 | Компонент, предоставляющий службу.                                                                                      | `proxy`                                                                                                                                                                                                           |
| **downstream\_cluster**       | Нижестоящая служба, т.е. клиентская служба.                                                                             | `outbound\|9080\|\|productpage.bookinfo-ns.svc.cluster.local`                                                                                                                                                     |
| **istio.canonical\_revision** | Версия службы.                                                                                                   | `latest`                                                                                                                                                                                                          |
| **istio.canonical\_service**  | Название службы.                                                                                                      | `productpage`                                                                                                                                                                                                     |
| **istio.mesh\_id**            | Название сервисной сети.                                                                                                 | `mesh-example`                                                                                                                                                                                                    |
| **istio.namespace**           | Название пространства имен, в котором находится служба.                                                                       | `bookinfo-ns`                                                                                                                                                                                                     |
| **node\_id**                  | Идентификатор, сгенерированный Istio по своим правилам для текущей службы.                                                 | `sidecar~10.5.1.189~bookinfo-productpage-6b5b6c6bbd-vdtsp.bookinfo-ns~bookinfo-ns.svc.cluster.local`                                                                                                              |
| **peer.address**              | IP-адрес или доменное имя, идентифицирующее удаленное устройство (собеседника), общающееся с локальным устройством.                       | `10.5.1.189`                                                                                                                                                                                                      |
| **upstream\_cluster**         | Входная служба, т.е. серверная служба.                                                                               | -`outbound\|9080\|\|details-canary.bookinfo-ns.svc.cluster.local` указывает, что входная служба - `details-canary.bookinfo-ns.svc.cluster.local`.<br />- `inbound\|80\|\|` указывает, что входная службы нет.       |
| **upstream\_cluster.name**    | Название входной службы.                                                                                             | `outbound\|9080\|\|details-canary.bookinfo-ns.svc.cluster.local`                                                                                                                                                  |

### Процесс

| Ключ                | Описание                                             | Пример значения                           |
| ------------------ | ------------------------------------------------------- | --------------------------------------- |
| **cluster.name**   | Название кластера.                                | `global`                                |
| **container.name** | Название контейнера Sidecar.                      | `istio-proxy`                           |
| **host.name**      | Название Pod.                                    | `bookinfo-productpage-6b5b6c6bbd-vdtsp` |
| **ms.name**        | Название службы.                                | `productpage`                           |
| **ms.namespace**   | Название пространства имен, в котором находится служба. | `bookinfo-ns`                           |
