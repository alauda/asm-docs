---
weight: 10
sourceSHA: b5d74ede1b96e4c7e0525ff28bd89eff238ea0aa5d9d4145b71b025a1ef75c96
---

# Запрос трассировки

## Общая информация о функции

Функция запроса распределенной трассировки предоставляет возможности полной трассировки для микросервисной архитектуры, собирая метаданные о межсервисных вызовах, помогая пользователям быстро находить проблемы с кросс-сервисными вызовами. Эта функция в первую очередь решает следующие задачи:

- **Трассировка ссылок запросов**: Восстановление полного пути запроса в сложных распределенных системах.
- **Анализ узких мест производительности**: Выявление аномальных узлов вызовов с точки зрения временных затрат в рамках ссылки.
- **Локализация коренной причины неисправности**: Быстрое определение места возникновения проблемы с помощью маркеров ошибок.

Применимые сценарии включают:

- Быстрое выявление аномальных сервисов во время устранения неполадок в производственной среде.
- Выявление цепочек вызовов с высокой задержкой во время настройки производительности.
- Проверка взаимосвязей межсервисных вызовов после выхода новой версии.

Основные ценности:

- Повышение наблюдаемости распределенных систем.
- Сокращение среднего времени на восстановление (MTTR).
- Оптимизация производительности межсервисных вызовов.

## Основные функции

- Мультидименсионный запрос: Поддержка 9 комбинаций условий запроса, таких как TraceID, имя сервиса, метки и др.
- Визуальный анализ: Интуитивное отображение иерархии вызовов и распределения времени с помощью графиков водопадов временных рядов.
- Точное定位: Поддержка фильтрации ошибок Span и вторичных поисков с помощью меток.

## Преимущества функции

- **Быстрая идентификация проблем**: Сужение области проверки с помощью мультидименсионных условий запроса ускоряет локализацию проблем.
- **Визуальное представление**: Использование графиков водопадов временных рядов для интуитивного отображения взаимосвязей вызовов снижает сложность и повышает эффективность анализа неисправностей.
- **Гибкость и разнообразие**: Поддержка как простых запросов, так и сложных комбинаций, адаптация под различные сценарии эксплуатации и разработки.

## Запрос трассировки

<Steps>
  ### Шаг 1: Скомбинировать условия запроса

  **Совет**: Условия запроса можно комбинировать. Вы можете уточнить свой запрос, добавив несколько условий запроса.

  | Условие запроса       | Описание                                                                                                                                                                                                                                                                                                                                               |
  | --------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
  | **TraceID**           | Уникальный идентификатор для полной ссылки, который может использоваться для запроса указанной трассировки.                                                                                                                                                                                                                                                              |
  | **Сервис**            | Сервис или шлюз входа, инициирующий/принимающий вызовы запросов (ввод обязательный). Формат: `<имя сервиса/шлюза>.<имя пространства имен>`, например, `bookinfo-gw.bookinfo-ns`.                                                                                                                                                                                 |
  | **Клиент**            | Клиентский сервис или шлюз входа, инициирующий вызов запроса (ввод обязательный). Формат: `<имя сервиса/шлюза>.<имя пространства имен>`.                                                                                                                                                                                                                  |
  | **Сервер**            | Серверный сервис или шлюз входа, отвечающий на вызов запроса (ввод обязательный). Формат: `<имя сервиса/шлюза>.<имя пространства имен>`.                                                                                                                                                                                                               |
  | **API**               | API, добавленный для сервиса в разделе **Сервисы > API**.                                                                                                                                                                                                                                                                                                      |
  | **Метеги**              | Вы можете отфильтровать результаты запроса, введя метки (Tag). Поддерживаемые метки включают метки, найденные в деталях Span.                                                                                                                                                                                                                                          |
  | **Продолжительность Span >**   | Spans, у которых продолжительность больше или равна *входному значению* (мс).                                                                                                                                                                                                                                                                                   |
  | **Только ошибочные трассировки** | Ошибочные Spans относятся к Spans, значение метки которых **error** равно `true`.                                                                                                                                                                                                                                                                                        |
  | **Тип Span**         | **Корневой Span**: Ищет корневые Spans, инициированные заданным **сервисом**. Этот режим поиска используется, когда заданный сервис является инициатором всего вызова запроса. <br />**Служебный входной Span**: Ищет первый Span, созданный, когда заданный **сервис** вызывается как сервер.                                              |
  | **Максимальное количество запросов**   | Максимальное количество Spans, которые можно запросить, по умолчанию `200`. <br />**Совет**: По соображениям производительности платформа может отображать максимум 1000 Spans за раз. Если количество Spans, соответствующих условиям запроса, превышает **максимальное количество запросов**, вы можете уточнить условия запроса или сузить временной диапазон для поэтапных запросов. |

  ### Шаг 2: Выполните запрос

  - После выбора условий запроса и ввода соответствующих значений нажмите кнопку **Добавить в запрос**, и текущие условия отобразятся в области вывода **Запрос**, чтобы инициировать запрос.
  - Вы также можете развернуть **Общие условия поиска**, чтобы быстро добавить недавно использованные условия поиска.
</Steps>

## Анализ результатов запроса

После ввода условий запроса и поиска на странице будет сгенерирована область результатов запроса.

### Список Span

Слева от области результатов запроса отображается список Spans, соответствующих условиям, вместе с базовой информацией о Spans, включая: имя сервиса, вызываемый интерфейс или метод обработки запроса, продолжительность и время начала.

### График водопадов временных рядов

График водопадов временных рядов с правой стороны от области результатов запроса четко отображает взаимосвязи вызовов между Spans в одной трассировке. Основные функции использования графиков водопадов временных рядов в анализе трассировки следующие:

1. Расширение сверху вниз: На графике водопадов временных рядов различные события вызова (Spans) обычно развиваются вниз от верхней части графика, при этом каждая горизонтальная полоса представляет собой вызов сервиса или процесса. Позиция, как правило, отражает логический порядок вызовов операций.
2. Выравнивание по оси времени: Горизонтальная ось графика водопадов временных рядов представляет время. Длина каждой полосы указывает на продолжительность этого вызова, что позволяет интуитивно сравнить временные отношения между различными вызовами.
3. Описание отступа: Отступ указывает на иерархические отношения вызовов, где более глубокий отступ обозначает большую глубину вызовов внутри этой ссылки.
4. Интерактивность и детальное отображение данных: Щелчок по полосам на графике водопадов временных рядов может отображать более детальную информацию о данном вызове.

### Детали Span

Нажав на строку Span на графике водопадов временных рядов, вы можете развернуть и просмотреть детальную информацию о Span, включая:

- Сервис: Сервис внутри Span.
- Продолжительность Span (мс): Продолжительность Span.
- URL: URL, доступный для сервиса, соответствующий **http.url** в метках Span.
- Метка: Информация о метке Span, состоящая из пар "ключ-значение", которую можно использовать для условий запроса по меткам. Нажав кнопку рядом с меткой, вы можете добавить текущее условие метки к условиям запроса для более точных результатов.
- JSON: Исходная структура JSON Span, позволяющая дальнейшую проверку его внутренней информации.
