---
weight: 10
---

# Service Routing

## Introduction
Service Routing enables precise control over inter-service traffic flow using Istio-powered rules. This functionality:

- Manages request distribution between services
- Supports complex traffic splitting scenarios
- Implements failure recovery mechanisms
- Provides non-intrusive testing capabilities

Core value: Enables fine-grained traffic management for microservice architectures

## Features
- Conditional routing based on 6 request attributes
- Weight-based traffic distribution
- 5 advanced traffic policies
- Cross-cluster routing support

## Advantages
**Precision**: 1% granular traffic control
**Flexibility**: Header/URI/Source-based matching
**Safety**: Built-in circuit breaking mechanisms
**Observability**: Integrated with monitoring metrics

## Routing Rules Configuration

### Rule Types
```yaml
http:
- match:
  - headers:
      user-type: internal
  route:
    ◦ destination:
        host: staging-service
      weight: 100
```

| Type | Priority | Matching Fields |
|------|----------|-----------------|
| Condition | High | URI/Headers/Source Labels |
| Weight | Low | Percentage distribution |

### Parameter Specifications
| Parameter | Constraints | Example |
|----------|------------|---------|
| Weight | Sum=100% | v1:80%, v2:20% |
| Regex Match | RE2 syntax | `^/api/v\d+/` |

## Routing Policies Management

### Policy Types
```yaml
retries:
  attempts: 3
  perTryTimeout: 2s
  retryOn: 5xx
```

| Policy | Parameters | Compatibility |
|--------|------------|---------------|
| Fault Injection | Error Rate(10%), Code(400) | ❌ Mirroring |
| Traffic Mirror | Target Service, Port | ✔️ Rewrite |
| Request Rewrite | Host/URI | Weight Rules Only |

### Timeout Calculation
```
Global Timeout (100ms) ≥
(Retry Timeout (10ms) × (Retries (8) + 1))
→ Valid configuration
```

## Route Creation Procedure

### Prerequisites
- Service protocol ports configured
- Canary release disabled
- Cross-cluster discovery enabled (optional)

### Step-by-Step Implementation
1. Navigate: **Service List** > **Target Service**
2. Select **Route** > **HTTP** tab
3. Click **Create Route** per cluster

```yaml
# Sample Route Configuration
- match:
  - uri:
      prefix: "/checkout"
  route:
    ◦ destination:
        host: payment-service
      weight: 100
    fault:
      delay:
        percentage: 5
        fixedDelay: 100ms
```

## Operational Constraints
1. **Protocol Limitations**:
   - TCP routes exclude advanced policies
   - gRPC requires HTTP/2 endpoints

2. **Priority System**:
   - Condition rules execute top-down
   - Weight rules process unmatched traffic

3. **Version Compatibility**:
   - Istio 1.6+ required for regex matching
   - Kubernetes 1.18+ for label-based routing
